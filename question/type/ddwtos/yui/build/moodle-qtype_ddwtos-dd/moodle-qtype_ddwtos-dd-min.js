YUI.add("moodle-qtype_ddwtos-dd",function(a,b){var c="ddwtos_dd",d=function(){d.superclass.constructor.apply(this,arguments)};a.extend(d,a.Base,{selectors:null,touchscrolldisable:null,initializer:function(){var b="qtype_ddwtos-"+Math.random().toString(36).slice(2);M.util.js_pending(b),this.selectors=this.css_selectors(this.get("topnode")),this.set_padding_sizes_all(),this.clone_drag_items(),this.initial_place_of_drag_items(),this.make_drop_zones(),this.get("readonly")?(a.later(500,this,this.position_drag_items,[b,3]),a.one("window").on("resize",function(){this.position_drag_items(b)},this)):a.later(500,this,this.position_drag_items,[b,!0])},css_selectors:function(a){return{top_node:function(){return a},drag_container:function(){return a+" div.drags"},drags:function(){return this.drag_container()+" span.drag"},drag:function(a){return this.drags()+".no"+a},drags_in_group:function(a){return this.drags()+".group"+a},unplaced_drags_in_group:function(a){return this.drags_in_group(a)+".unplaced"},drags_for_choice_in_group:function(a,b){return this.drags_in_group(b)+".choice"+a},unplaced_drags_for_choice_in_group:function(a,b){return this.unplaced_drags_in_group(b)+".choice"+a},drops:function(){return a+" span.drop"},drop_for_place:function(a){return this.drops()+".place"+a},drops_in_group:function(a){return this.drops()+".group"+a},drag_homes:function(){return a+" span.draghome"},drag_homes_group:function(b){return a+" .draggrouphomes"+b+" span.draghome"},drag_home:function(b,c){return a+" .draggrouphomes"+b+" span.draghome.choice"+c},drops_group:function(b){return a+" span.drop.group"+b}}},set_padding_sizes_all:function(){for(var a=1;a<=8;a++)this.set_padding_size_for_group(a)},set_padding_size_for_group:function(b){var c=a.all(this.selectors.drag_homes_group(b));if(0!==c.size()){var d=0,e=0;c.each(function(a){d=Math.max(d,Math.ceil(a.get("offsetWidth"))),e=Math.max(e,Math.ceil(a.get("offsetHeight")))},this),d+=8,e+=2,c.each(function(a){this.pad_to_width_height(a,d,e)},this),a.all(this.selectors.drops_group(b)).each(function(a){this.pad_to_width_height(a,d+2,e+2)},this)}},pad_to_width_height:function(a,b,c){a.setStyle("width",b+"px").setStyle("height",c+"px").setStyle("lineHeight",c+"px")},clone_drag_items:function(){a.all(this.selectors.drag_homes()).each(this.clone_drag_items_for_one_choice,this)},clone_drag_items_for_one_choice:function(b){if(b.hasClass("infinite"))for(var c=this.get_group(b),d=a.all(this.selectors.drops_in_group(c)).size(),e=0;e<d;e++)this.clone_drag_item(b);else this.clone_drag_item(b)},nextdragitemno:1,clone_drag_item:function(b){var c=b.cloneNode(!0);c.removeClass("draghome"),c.addClass("drag"),c.addClass("no"+this.nextdragitemno),this.nextdragitemno++,c.setStyles({visibility:"visible",position:"absolute"}),a.one(this.selectors.drag_container()).appendChild(c),this.get("readonly")||this.make_draggable(c)},get_classname_numeric_suffix:function(a,b){var c=a.getAttribute("class");if(""!==c)for(var d=c.split(" "),e=0;e<d.length;e++){var f=new RegExp("^"+b+"([0-9])+$");if(f.test(d[e])){var g=new RegExp("([0-9])+$"),h=g.exec(d[e]);return Number(h[0])}}throw'Prefix "'+b+'" not found in class names.'},get_choice:function(a){return this.get_classname_numeric_suffix(a,"choice")},get_group:function(a){return this.get_classname_numeric_suffix(a,"group")},get_place:function(a){return this.get_classname_numeric_suffix(a,"place")},get_no:function(a){return this.get_classname_numeric_suffix(a,"no")},placed:null,initial_place_of_drag_items:function(){a.all(this.selectors.drags()).addClass("unplaced"),this.placed=[];for(var b in this.get("inputids")){var c=this.get("inputids")[b],d=a.one("input#"+c),e=Number(d.get("value"));if(0!==e){var f=a.one(this.selectors.drop_for_place(b)),g=this.get_group(f),h=a.one(this.selectors.unplaced_drags_for_choice_in_group(e,g));this.place_drag_in_drop(h,f),this.position_drag_item(h)}}},make_draggable:function(b){new a.DD.Drag({node:b,groups:[this.get_group(b)],dragMode:"point"}).plug(a.Plugin.DDConstrained,{constrain2node:this.selectors.top_node()}),this.prevent_touchmove_from_scrolling(b)},prevent_touchmove_from_scrolling:function(b){var c=a.UA.ie?"MSPointerStart":"touchstart",d=a.UA.ie?"MSPointerEnd":"touchend",e=a.UA.ie?"MSPointerMove":"touchmove";b.on(c,function(){this.touchscrolldisable||(this.touchscrolldisable=a.one("body").on(e,function(a){a=a||window.event,a.preventDefault()}))},this),b.on(d,function(){this.touchscrolldisable&&(this.touchscrolldisable.detach(),this.touchscrolldisable=null)},this)},make_drop_zones:function(){a.all(this.selectors.drops()).each(this.make_drop_zone,this)},make_drop_zone:function(b){var c=new a.DD.Drop({node:b,groups:[this.get_group(b)]});c.on("drop:hit",function(a){var b=a.drag.get("node"),c=a.drop.get("node");this.get_group(c)===this.get_group(b)&&this.place_drag_in_drop(b,c)},this),this.get("readonly")||b.on("dragchange",this.drop_zone_key_press,this)},place_drag_in_drop:function(b,c){var d=this.get_place(c),e=this.get("inputids")[d],f=a.one("input#"+e);null!==b?f.set("value",this.get_choice(b)):f.set("value","0");for(var g in this.placed)if(this.placed[g]===d){delete this.placed[g];var h=a.one(this.selectors.drag(g));h&&h.dd&&h.dd.detach("drag:start")}null!==b&&(this.placed[this.get_no(b)]=d,b.dd&&b.dd.once("drag:start",function(a,b,c){b.set("value",0),delete this.placed[this.get_no(c)],c.addClass("unplaced")},this,f,b))},remove_drag_from_drop:function(a){this.place_drag_in_drop(null,a)},position_drag_items:function(b,c){a.all(this.selectors.drags()).each(this.position_drag_item,this),M.util.js_complete(b),(c===!0||c>0)&&(c!==!0&&(c-=1),a.later(500,this,this.position_drag_items,[b,c]))},position_drag_item:function(b){if(!b.hasClass("yui3-dd-dragging"))if(this.placed[this.get_no(b)]){var c=this.placed[this.get_no(b)],d=a.one(this.selectors.drop_for_place(c));b.setXY([d.getX()+2,d.getY()+2]),b.removeClass("unplaced")}else{var e=this.get_group(b),f=this.get_choice(b),g=a.one(this.selectors.drag_home(e,f));b.setXY(g.getXY()),b.addClass("unplaced")}},drop_zone_key_press:function(a){switch(a.direction){case"next":this.place_next_drag_in(a.target);break;case"previous":this.place_previous_drag_in(a.target);break;case"remove":this.remove_drag_from_drop(a.target)}a.preventDefault()},place_next_drag_in:function(a){this.choose_next_choice_for_drop(a,1)},place_previous_drag_in:function(a){this.choose_next_choice_for_drop(a,-1)},choose_next_choice_for_drop:function(b,c){var d,e=this.get_group(b),f=this.current_choice_in_drop(b),g=a.all(this.selectors.unplaced_drags_in_group(e));if(0===f)if(1===c)d=1;else{var h=g.pop();d=this.get_choice(h)}else d=f+c;var i;do{if(i=a.one(this.selectors.unplaced_drags_for_choice_in_group(d,e)),null===a.one(this.selectors.drags_for_choice_in_group(d,e)))return void this.remove_drag_from_drop(b);d+=c}while(null===i);this.place_drag_in_drop(i,b)},current_choice_in_drop:function(b){var c=this.get("inputids")[this.get_place(b)],d=a.one("input#"+c);return Number(d.get("value"))}},{NAME:c,ATTRS:{readonly:{value:!1},topnode:{value:null},inputids:{value:null}}}),a.Event.define("dragchange",{_event:a.UA.webkit||a.UA.ie?"keydown":"keypress",_keys:{32:"next",37:"previous",38:"previous",39:"next",40:"next",27:"remove"},_keyHandler:function(a,b){this._keys[a.keyCode]&&(a.direction=this._keys[a.keyCode],b.fire(a))},on:function(a,b,c){b._detacher=a.on(this._event,this._keyHandler,this,c)}}),M.qtype_ddwtos=M.qtype_ddwtos||{},M.qtype_ddwtos.init_question=function(a){return new d(a)}},"@VERSION@",{requires:["node","dd","dd-drop","dd-constrain"]});