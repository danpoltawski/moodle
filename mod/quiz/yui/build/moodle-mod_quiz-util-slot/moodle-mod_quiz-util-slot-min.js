YUI.add("moodle-mod_quiz-util-slot",function(a,b){a.namespace("Moodle.mod_quiz.util.slot"),a.Moodle.mod_quiz.util.slot={CSS:{SLOT:"slot",QUESTIONTYPEDESCRIPTION:"qtype_description",CANNOT_DEPEND:"question_dependency_cannot_depend"},CONSTANTS:{SLOTIDPREFIX:"slot-",QUESTION:M.util.get_string("question","moodle")},SELECTORS:{SLOT:"li.slot",INSTANCENAME:".instancename",NUMBER:"span.slotnumber",PAGECONTENT:"div#page-content",PAGEBREAK:"span.page_split_join_wrapper",ICON:"img",QUESTIONTYPEDESCRIPTION:".qtype_description",SECTIONUL:"ul.section",DEPENDENCY_WRAPPER:".question_dependency_wrapper",DEPENDENCY_LINK:".question_dependency_wrapper .cm-edit-action",DEPENDENCY_ICON:".question_dependency_wrapper img"},getSlotFromComponent:function(b){return a.one(b).ancestor(this.SELECTORS.SLOT,!0)},getId:function(a){var b=a.get("id").replace(this.CONSTANTS.SLOTIDPREFIX,"");return b=parseInt(b,10),!("number"!=typeof b||!isFinite(b))&&b},getName:function(a){var b=a.one(this.SELECTORS.INSTANCENAME);return b?b.get("firstChild").get("data"):null},getNumber:function(a){if(!a)return!1;var b=a.one(this.SELECTORS.NUMBER).get("text").replace(this.CONSTANTS.QUESTION,"");return b=parseInt(b,10),!("number"!=typeof b||!isFinite(b))&&b},setNumber:function(a,b){var c=a.one(this.SELECTORS.NUMBER);c.setHTML('<span class="accesshide">'+this.CONSTANTS.QUESTION+"</span> "+b)},getSlots:function(){return a.all(this.SELECTORS.PAGECONTENT+" "+this.SELECTORS.SECTIONUL+" "+this.SELECTORS.SLOT)},getNumberedSlots:function(){var b=this.SELECTORS.PAGECONTENT+" "+this.SELECTORS.SECTIONUL;return b+=" "+this.SELECTORS.SLOT+":not("+this.SELECTORS.QUESTIONTYPEDESCRIPTION+")",a.all(b)},getPrevious:function(a){return a.previous(this.SELECTORS.SLOT)},getPreviousNumbered:function(a){var b=a.previous(this.SELECTORS.SLOT+":not("+this.SELECTORS.QUESTIONTYPEDESCRIPTION+")");if(b)return b;for(var c=a.ancestor("li.section").previous("li.section");c;){var d=c.all(this.SELECTORS.SLOT+":not("+this.SELECTORS.QUESTIONTYPEDESCRIPTION+")");if(d.size()>0)return d.item(d.size()-1);c=c.previous("li.section")}return!1},reorderSlots:function(){var b=this.getSlots();b.each(function(b){if(!a.Moodle.mod_quiz.util.page.getPageFromSlot(b)){var c=b.next(a.Moodle.mod_quiz.util.page.SELECTORS.PAGE);b.swap(c)}var d=this.getPreviousNumbered(b),e=0;b.hasClass(this.CSS.QUESTIONTYPEDESCRIPTION)||(d&&(e=this.getNumber(d)),this.setNumber(b,e+1))},this)},updateOneSlotSections:function(){a.all(".mod-quiz-edit-content ul.slots li.section").each(function(a){a.all(this.SELECTORS.SLOT).size()>1?a.removeClass("only-has-one-slot"):a.addClass("only-has-one-slot")},this)},remove:function(b){var c=a.Moodle.mod_quiz.util.page.getPageFromSlot(b);b.remove(),a.Moodle.mod_quiz.util.page.isEmpty(c)&&a.Moodle.mod_quiz.util.page.remove(c)},getPageBreaks:function(){var b=this.SELECTORS.PAGECONTENT+" "+this.SELECTORS.SECTIONUL;return b+=" "+this.SELECTORS.SLOT+this.SELECTORS.PAGEBREAK,a.all(b)},getPageBreak:function(b){return a.one(b).one(this.SELECTORS.PAGEBREAK)},addPageBreak:function(b){var c=M.mod_quiz.resource_toolbox.get("config").addpageiconhtml;c=c.replace("%%SLOT%%",this.getNumber(b));var d=a.Node.create(c);return b.one("div").insert(d,"after"),d},removePageBreak:function(a){var b=this.getPageBreak(a);return!!b&&(b.remove(),!0)},reorderPageBreaks:function(){var b=this.getSlots(),c=0;b.each(function(d,e){c++;var f=this.getPageBreak(d),g=d.next("li.activity");if(g){f||(f=this.addPageBreak(d)),f&&e===b.size()-1&&this.removePageBreak(d);var h=f.get("childNodes").item(0),i="",j="";a.Moodle.mod_quiz.util.page.isPage(g)?(i="removepagebreak",j="e/remove_page_break"):(i="addpagebreak",j="e/insert_page_break"),h.set("title",M.util.get_string(i,"quiz")),h.setData("action",i);var k=h.one(this.SELECTORS.ICON);k.set("title",M.util.get_string(i,"quiz")),k.set("alt",M.util.get_string(i,"quiz")),k.set("src",M.util.image_url(j));var l=a.QueryString.parse(h.get("href"));l.slot=c;var m="";for(var n in l)m.length&&(m+="&"),m+=n+"="+l[n];h.set("href",m)}},this)},updateAllDependencyIcons:function(){var a=this.getSlots(),b=0,c=null;a.each(function(a){b++,1==b||"0"===c.getData("canfinish")?a.one(this.SELECTORS.DEPENDENCY_WRAPPER).addClass(this.CSS.CANNOT_DEPEND):a.one(this.SELECTORS.DEPENDENCY_WRAPPER).removeClass(this.CSS.CANNOT_DEPEND),this.updateDependencyIcon(a,null),c=a},this)},updateDependencyIcon:function(a,b){var c=a.one(this.SELECTORS.DEPENDENCY_LINK),d=a.one(this.SELECTORS.DEPENDENCY_ICON),e=this.getPrevious(a),f={thisq:this.getNumber(a)};e&&(f.previousq=this.getNumber(e)),null===b&&(b="removedependency"===c.getData("action")),b?(c.set("title",M.util.get_string("questiondependencyremove","quiz",f)),c.setData("action","removedependency"),d.set("alt",M.util.get_string("questiondependsonprevious","quiz")),d.set("src",M.util.image_url("t/locked","moodle"))):(c.set("title",M.util.get_string("questiondependencyadd","quiz",f)),c.setData("action","adddependency"),d.set("alt",M.util.get_string("questiondependencyfree","quiz")),d.set("src",M.util.image_url("t/unlocked","moodle")))}}},"@VERSION@",{requires:["node","moodle-mod_quiz-util-base"]});