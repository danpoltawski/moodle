YUI.add("moodle-mod_quiz-util-page",function(a,b){a.namespace("Moodle.mod_quiz.util.page"),a.Moodle.mod_quiz.util.page={CSS:{PAGE:"page"},CONSTANTS:{ACTIONMENUIDPREFIX:"action-menu-",ACTIONMENUBARIDSUFFIX:"-menubar",ACTIONMENUMENUIDSUFFIX:"-menu",PAGEIDPREFIX:"page-",PAGENUMBERPREFIX:M.util.get_string("page","moodle")+" "},SELECTORS:{ACTIONMENU:"div.moodle-actionmenu",ACTIONMENUBAR:".menubar",ACTIONMENUMENU:".menu",ADDASECTION:'[data-action="addasection"]',PAGE:"li.page",INSTANCENAME:".instancename",NUMBER:"h4"},getPageFromComponent:function(b){return a.one(b).ancestor(this.SELECTORS.PAGE,!0)},getPageFromSlot:function(b){return a.one(b).previous(this.SELECTORS.PAGE)},getId:function(a){var b=a.get("id").replace(this.CONSTANTS.PAGEIDPREFIX,"");return b=parseInt(b,10),!("number"!=typeof b||!isFinite(b))&&b},setId:function(a,b){a.set("id",this.CONSTANTS.PAGEIDPREFIX+b)},getName:function(a){var b=a.one(this.SELECTORS.INSTANCENAME);return b?b.get("firstChild").get("data"):null},getNumber:function(a){var b=a.one(this.SELECTORS.NUMBER).get("text").replace(this.CONSTANTS.PAGENUMBERPREFIX,"");return b=parseInt(b,10),!("number"!=typeof b||!isFinite(b))&&b},setNumber:function(a,b){a.one(this.SELECTORS.NUMBER).set("text",this.CONSTANTS.PAGENUMBERPREFIX+b)},getPages:function(){return a.all(a.Moodle.mod_quiz.util.slot.SELECTORS.PAGECONTENT+" "+a.Moodle.mod_quiz.util.slot.SELECTORS.SECTIONUL+" "+this.SELECTORS.PAGE)},isPage:function(a){return!!a&&a.hasClass(this.CSS.PAGE)},isEmpty:function(a){var b=a.next("li.activity");return!b||!b.hasClass("slot")},add:function(b){var c=this.getNumber(this.getPageFromSlot(b))+1,d=M.mod_quiz.resource_toolbox.get("config").pagehtml;d=d.replace(/%%PAGENUMBER%%/g,c);var e=a.Node.create(d);return YUI().use("dd-drop",function(a){var b=new a.DD.Drop({node:e,groups:M.mod_quiz.dragres.groups});e.drop=b}),b.insert(e,"after"),"undefined"!=typeof M.core.actionmenu&&M.core.actionmenu.newDOMNode(e),e},remove:function(b,c){var d=b.previous(a.Moodle.mod_quiz.util.slot.SELECTORS.SLOT);!c&&d&&a.Moodle.mod_quiz.util.slot.removePageBreak(d),b.remove()},reorderPages:function(){var a=this.getPages(),b=0;a.each(function(a){if(this.isEmpty(a)){var c=!!a.next("li.slot");return void this.remove(a,c)}b++,this.setNumber(a,b),this.setId(a,b)},this),this.reorderActionMenus()},reorderActionMenus:function(){var a=this.getActionMenus();a.each(function(b,c){var d=a.item(c-1),e=0;d&&(e=this.getActionMenuId(d));var f=e+1;this.setActionMenuId(b,f);var g=b.one(this.SELECTORS.ACTIONMENUBAR);g.set("id",this.CONSTANTS.ACTIONMENUIDPREFIX+f+this.CONSTANTS.ACTIONMENUBARIDSUFFIX);var h=b.one(this.SELECTORS.ACTIONMENUMENU);h.set("id",this.CONSTANTS.ACTIONMENUIDPREFIX+f+this.CONSTANTS.ACTIONMENUMENUIDSUFFIX),h.one(this.SELECTORS.ADDASECTION).set("href",h.one(this.SELECTORS.ADDASECTION).get("href").replace(/\baddsectionatpage=\d/,"addsectionatpage="+f))},this)},getActionMenus:function(){return a.all(a.Moodle.mod_quiz.util.slot.SELECTORS.PAGECONTENT+" "+a.Moodle.mod_quiz.util.slot.SELECTORS.SECTIONUL+" "+this.SELECTORS.ACTIONMENU)},getActionMenuId:function(a){var b=a.get("id").replace(this.CONSTANTS.ACTIONMENUIDPREFIX,"");return b=parseInt(b,10),!("number"!=typeof b||!isFinite(b))&&b},setActionMenuId:function(a,b){a.set("id",this.CONSTANTS.ACTIONMENUIDPREFIX+b)}}},"@VERSION@",{requires:["node","moodle-mod_quiz-util-base"]});