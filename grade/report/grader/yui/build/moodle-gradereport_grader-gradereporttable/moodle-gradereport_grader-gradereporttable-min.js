YUI.add("moodle-gradereport_grader-gradereporttable",function(a,b){function c(){c.superclass.constructor.apply(this,arguments)}function d(){}var e={FOOTERTITLE:".avg .header",FOOTERCELLS:"#user-grades .avg .cell",FOOTERROW:"#user-grades .avg",GRADECELL:"td.grade",GRADERTABLE:".gradeparent table",GRADEPARENT:".gradeparent",HEADERCELLS:"#user-grades .heading .cell",HEADERCELL:".gradebook-header-cell",HEADERROW:"#user-grades tr.heading",STUDENTHEADER:"#studentheader",USERCELL:"#user-grades .user.cell",USERMAIL:"#user-grades .useremail"},f={OVERRIDDEN:"overridden",TOOLTIPACTIVE:"tooltipactive"};a.extend(c,a.Base,{_eventHandles:[],graderTable:null,initializer:function(){this.graderRegion=a.one(e.GRADEPARENT),this.graderTable=a.one(e.GRADERTABLE),this.setupFloatingHeaders()},getGradeUserName:function(a){var b=a.ancestor("tr"),c=b.one("th.user .username");return c?c.get("text"):""},getGradeItemName:function(b){var c=a.one("th.item[data-itemid='"+b.getData("itemid")+"']");return c?c.get("text"):""},getGradeFeedback:function(a){return a.getData("feedback")}}),a.namespace("M.gradereport_grader").ReportTable=c,a.namespace("M.gradereport_grader").init=function(b){return new a.M.gradereport_grader.ReportTable(b)};var g="height",h="width",i="offsetWidth",j="offsetHeight";f.FLOATING="floating",d.ATTRS={},d.prototype={pageHeaderHeight:0,container:null,headerCell:null,headerRow:null,firstUserCell:null,firstNonUserCell:null,firstNonUserCellLeft:0,firstNonUserCellWidth:0,tableFooterRow:null,footerRow:null,gradeItemHeadingContainer:null,userColumnHeader:null,userColumn:null,firstUserCellBottom:0,firstUserCellLeft:0,firstUserCellWidth:0,dockWidth:0,lastUserCellTop:0,floatingHeaderRow:null,_eventHandles:[],lastBodyMargin:0,setupFloatingHeaders:function(){return this.firstUserCell=a.one(e.USERCELL),this.container=a.one(e.GRADEPARENT),this.firstNonUserCell=a.one(e.GRADECELL),this.firstUserCell?M.cfg.behatsiterunning?void 0:(this._setupFloatingUserColumn(),this._setupFloatingUserHeader(),this._setupFloatingAssignmentHeaders(),this._setupFloatingAssignmentFooter(),this.floatingHeaderRow={},this._setupFloatingLeftHeaders(".controls .controls"),this._setupFloatingLeftHeaders(".range .range"),this._setupFloatingLeftHeaders(e.FOOTERTITLE),this._setupFloatingAssignmentFooterTitle(),this._calculateCellPositions(),this._handleScrollEvent(),this._setupEventHandlers(),a.Global.on("moodle-gradereport_grader:resized",this._handleResizeEvent,this),this):this},_calculateCellPositions:function(){this.headerRowTop=this.headerRow.getY(),this.tableFooterRow&&(this.footerRowPosition=this.tableFooterRow.getY()),this.dockWidth=0;var b=a.one(".has_dock #dock");b&&(this.dockWidth=b.get(i));var c=a.all(e.USERCELL);if(this.firstUserCellLeft=this.firstUserCell.getX(),this.firstUserCellWidth=this.firstUserCell.get(i),this.firstNonUserCellLeft=this.firstNonUserCell.getX(),this.firstNonUserCellWidth=this.firstNonUserCell.get(i),c.size()>1){var d=c.item(1);this.firstUserCellBottom=d.getY()+parseInt(d.getComputedStyle(g),10),this.lastUserCellTop=c.item(c.size()-2).getY()}else{var f=c.item(0);this.lastUserCellTop=f.getY(),this.tableFooterRow?this.firstUserCellBottom=this.footerRowPosition+parseInt(this.tableFooterRow.getComputedStyle(g),10):this.firstUserCellBottom=f.getY()+f.get("offsetHeight")}var h=a.one("header");if(this.pageHeaderHeight=0,h)if("fixed"===h.getComputedStyle("position"))this.pageHeaderHeight=h.get(j);else{var k=a.one(".navbar");k&&"fixed"===k.getComputedStyle("position")&&(this.pageHeaderHeight=k.get(j))}},_getRelativeXY:function(a){return this._getRelativeXYFromXY(a.getX(),a.getY())},_getRelativeXYFromXY:function(a,b){var c=this.container.getXY();return[a-c[0],b-c[1]]},_getRelativeXFromX:function(a){return this._getRelativeXYFromXY(a,0)[0]},_getRelativeYFromY:function(a){return this._getRelativeXYFromXY(0,a)[1]},_getScrollBarHeight:function(){return a.UA.ie&&a.UA.ie>=10?0:a.config.doc.body.scrollWidth>a.config.doc.body.clientWidth?a.DOM.getScrollbarWidth():0},_setupEventHandlers:function(){this._eventHandles.push(a.one(a.config.win).on("scroll",this._handleScrollEvent,this),a.one(a.config.win).on("resize",this._handleResizeEvent,this),a.one(a.config.win).on("orientationchange",this._handleResizeEvent,this),a.Global.on("dock:shown",this._handleResizeEvent,this),a.Global.on("dock:hidden",this._handleResizeEvent,this))},_setupFloatingUserColumn:function(){var b=a.all(e.USERCELL),c=a.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly"></div>'),d=this._getRelativeXY(this.firstUserCell);b.each(function(b){var d=b.getComputedStyle(g);if(0!==a.UA.ie){var e=b.get("offsetHeight"),f=parseInt(b.getComputedStyle("marginTop"),10)+parseInt(b.getComputedStyle("marginBottom"),10),i=parseInt(b.getComputedStyle("paddingTop"),10)+parseInt(b.getComputedStyle("paddingBottom"),10),j=parseInt(b.getComputedStyle("borderTopWidth"),10)+parseInt(b.getComputedStyle("borderBottomWidth"),10);d=e-f-i-j}var k=a.Node.create("<div></div>");k.set("innerHTML",b.get("innerHTML")).setAttribute("class",b.getAttribute("class")).setAttribute("data-uid",b.ancestor("tr").getData("uid")).setStyles({height:d,width:b.getComputedStyle(h)}),c.appendChild(k)},this),c.setStyles({left:d[0]+"px",position:"absolute",top:d[1]+"px"}),this.graderRegion.append(c),this.userColumn=c},_setupFloatingUserHeader:function(){this.headerRow=a.one(e.HEADERROW),this.headerCell=a.one(e.STUDENTHEADER);var b=a.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly heading"></div>'),c=a.Node.create("<div></div>"),d=this._getRelativeXY(this.headerCell)[0],f=this._getRelativeXY(this.headerRow),g=f[0];c.set("innerHTML",this.headerCell.getHTML()).setAttribute("class",this.headerCell.getAttribute("class")).setStyles({width:this.firstUserCell.getComputedStyle(h),left:d-g+"px"}),b.setStyles({left:f[0]+"px",position:"absolute",top:f[1]+"px"}),b.append(c),this.graderRegion.append(b),this.userColumnHeader=b},_setupFloatingAssignmentHeaders:function(){this.headerRow=a.one("#user-grades tr.heading");var b=a.all("#user-grades tr.heading .cell"),c=a.Node.create('<div aria-hidden="true" role="presentation" class="floater heading"></div>'),d=this._getRelativeXY(this.headerRow),e=0,f=0,k=d[0];b.each(function(b){var d=this._getRelativeXY(b)[0],l=a.Node.create("<div></div>");l.append(b.getHTML()).setAttribute("class",b.getAttribute("class")).setData("itemid",b.getData("itemid")).setStyles({height:b.getComputedStyle(g),left:d-k+"px",position:"absolute",width:b.getComputedStyle(h)}),e+=parseInt(b.get(i),10),f=b.get(j),c.appendChild(l)},this),c.setStyles({height:f+"px",left:d[0]+"px",position:"absolute",top:d[1]+"px",width:e+"px"}),this.userColumnHeader.insert(c,"before"),this.gradeItemHeadingContainer=c},_setupFloatingAssignmentFooter:function(){if(this.tableFooterRow=a.one("#user-grades .avg"),this.tableFooterRow){var b=this.tableFooterRow.all(".cell"),c=a.Node.create('<div aria-hidden="true" role="presentation" class="floater avg"></div>'),d=0,e=this._getRelativeXY(this.tableFooterRow),f=e[0],k=0;b.each(function(b){var e=a.Node.create("<div></div>"),l=this._getRelativeXY(b)[0];e.set("innerHTML",b.getHTML()).setAttribute("class",b.getAttribute("class")).setStyles({height:b.getComputedStyle(g),left:l-f+"px",position:"absolute",width:b.getComputedStyle(h)}),c.append(e),k=b.get(j),d+=parseInt(b.get(i),10)},this),c.setStyles({position:"absolute",left:e[0]+"px",bottom:"1px",height:k+"px",width:d+"px"}),this.graderRegion.append(c),this.footerRow=c}},_setupFloatingAssignmentFooterTitle:function(){var a=this.floatingHeaderRow[e.FOOTERTITLE];a&&a.setStyles({bottom:"1px"})},_setupFloatingLeftHeaders:function(b){var c=a.one(b);if(c){var d=a.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly"></div>'),e=a.Node.create("<div></div>"),f=this._getRelativeXY(c),g=this.firstUserCell.getComputedStyle(h),i=c.get(j);e.set("innerHTML",c.getHTML()).setAttribute("class",c.getAttribute("class")).setStyles({width:g}),d.setStyles({position:"absolute",top:f[1]+"px",left:f[0]+"px",height:i+"px"}).addClass(c.get("parentNode").get("className")),d.append(e),this.graderRegion.append(d),this.floatingHeaderRow[b]=d}},_handleScrollEvent:function(){var b={},c={},d={},h={},i=0,j=0,k=0,l=!1,m=!1,n=!1,o=!1,p={},q={},r=!1,s=0;if(s=window.right_to_left()?parseInt(a.one(a.config.doc.body).getComputedStyle("marginRight"),10):parseInt(a.one(a.config.doc.body).getComputedStyle("marginLeft"),10),s!=this.lastBodyMargin&&this._calculateCellPositions(),b.left=this._getRelativeXFromX(this.headerRow.getX()),a.config.win.pageYOffset+this.pageHeaderHeight>this.headerRowTop?(l=!0,a.config.win.pageYOffset+this.pageHeaderHeight<this.lastUserCellTop?(i=this._getRelativeYFromY(a.config.win.pageYOffset+this.pageHeaderHeight),b.top=i+"px",c.top=i+"px"):(i=this._getRelativeYFromY(this.lastUserCellTop),b.top=i+"px",c.top=i+"px")):(l=!1,i=this._getRelativeYFromY(this.headerRowTop),b.top=i+"px",c.top=i+"px"),window.right_to_left()?(j=a.config.win.innerWidth+a.config.win.pageXOffset-this.dockWidth,k=j-this.firstUserCellWidth-s,m=j<this.firstUserCellLeft+this.firstUserCellWidth+s,o=j-this.firstNonUserCellWidth<this.firstNonUserCellLeft+this.firstUserCellWidth):(k=a.config.win.pageXOffset+s,j=k+this.dockWidth+s,m=j>this.firstUserCellLeft+s,o=j>this.firstNonUserCellLeft-this.firstUserCellWidth),m?(i=this._getRelativeXFromX(k),d.left=i+"px",c.left=i+"px"):(i=this._getRelativeXFromX(this.firstUserCellLeft),d.left=i+"px",c.left=i+"px"),a.Object.each(this.floatingHeaderRow,function(a,b){p[b]={left:d.left}},this),this.footerRow){h.left=this._getRelativeXFromX(this.headerRow.getX());var t=a.config.win.innerHeight,u=a.config.win.pageYOffset,v=t-this._getScrollBarHeight()+u,w=parseInt(this.footerRow.getComputedStyle(g),10),x=w+this.footerRowPosition;q=p[e.FOOTERTITLE],r=this.floatingHeaderRow[e.FOOTERTITLE],v<x&&v>this.firstUserCellBottom?(h.bottom=Math.ceil(x-v)+"px",n=!0):(h.bottom="1px",n=!1),q&&(q.bottom=h.bottom,q.top=null),p[e.FOOTERTITLE]=q}this.gradeItemHeadingContainer&&(this.gradeItemHeadingContainer.setStyles(b),l?this.gradeItemHeadingContainer.addClass(f.FLOATING):this.gradeItemHeadingContainer.removeClass(f.FLOATING)),this.userColumnHeader&&(this.userColumnHeader.setStyles(c),m?this.userColumnHeader.addClass(f.FLOATING):this.userColumnHeader.removeClass(f.FLOATING)),this.userColumn&&(this.userColumn.setStyles(d),m?this.userColumn.addClass(f.FLOATING):this.userColumn.removeClass(f.FLOATING)),this.footerRow&&(this.footerRow.setStyles(h),n?this.footerRow.addClass(f.FLOATING):this.footerRow.removeClass(f.FLOATING)),a.Object.each(p,function(a,b){this.floatingHeaderRow[b]&&this.floatingHeaderRow[b].setStyles(a)},this),a.Object.each(this.floatingHeaderRow,function(a,b){this.floatingHeaderRow[b]&&(o?this.floatingHeaderRow[b].addClass(f.FLOATING):this.floatingHeaderRow[b].removeClass(f.FLOATING))},this),r&&(o?r.addClass(f.FLOATING):r.removeClass(f.FLOATING))},_handleResizeEvent:function(){this._calculateCellPositions(),this._handleScrollEvent();var b=this.firstUserCell.getComputedStyle(h),c=a.all(e.USERCELL);this.userColumnHeader.one(".cell").setStyle("width",b),this.userColumn.all(".cell").each(function(d,e){var f=c.item(e).getComputedStyle(g);if(0!==a.UA.ie){var h=c.item(e),i=h.getDOMNode?h.getDOMNode().getBoundingClientRect().height:h.get("offsetHeight"),j=parseInt(h.getComputedStyle("marginTop"),10)+parseInt(h.getComputedStyle("marginBottom"),10),k=parseInt(h.getComputedStyle("paddingTop"),10)+parseInt(h.getComputedStyle("paddingBottom"),10),l=parseInt(h.getComputedStyle("borderTopWidth"),10)+parseInt(h.getComputedStyle("borderBottomWidth"),10);f=i-j-k-l}d.setStyles({width:b,height:f})},this);var d=this.gradeItemHeadingContainer.all(".cell"),f=a.all(e.HEADERCELLS),j=this.headerRow.getX(),k=0;if(f.each(function(a,b){var c=d.item(b);k+=a.get(i);var e={width:a.getComputedStyle(h),left:a.getX()-j+"px"};c.setStyles(e)}),this.footerRow){var l=this.footerRow.all(".cell");if(0!==l.size()){var m=a.all(e.FOOTERCELLS);m.each(function(a,b){var c=l.item(b),d={width:a.getComputedStyle(h),left:a.getX()-j+"px"};c.setStyles(d)})}}a.Object.each(this.floatingHeaderRow,function(a){a.one("div").setStyle("width",b)},this),this.gradeItemHeadingContainer.setStyle("width",k)}},a.Base.mix(a.M.gradereport_grader.ReportTable,[d])},"@VERSION@",{requires:["base","node","event","handlebars","overlay","event-hover"]});