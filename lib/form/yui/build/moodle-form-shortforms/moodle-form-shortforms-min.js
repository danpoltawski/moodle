YUI.add("moodle-form-shortforms",function(a,b){function c(){c.superclass.constructor.apply(this,arguments)}var d={COLLAPSEEXPAND:".collapsible-actions .collapseexpand",COLLAPSED:".collapsed",FIELDSETCOLLAPSIBLE:"fieldset.collapsible",FIELDSETLEGENDLINK:"fieldset.collapsible .fheader",FHEADER:".fheader",LEGENDFTOGGLER:"legend.ftoggler"},e={COLLAPSEALL:"collapse-all",COLLAPSED:"collapsed",FHEADER:"fheader"},f={};f.formid={value:null},a.extend(c,a.Base,{form:null,initializer:function(){var b,c,e,f,g=a.one("#"+this.get("formid"));g&&(this.form=g,b=g.all(d.FIELDSETCOLLAPSIBLE),b.each(this.process_fieldset,this),g.delegate("click",this.switch_state,d.FIELDSETLEGENDLINK,this),g.delegate("key",this.switch_state,"down:enter,32",d.FIELDSETLEGENDLINK,this),a.Global.on(M.core.globalEvents.FORM_ERROR,this.expand_fieldset,this),c=g.one(d.COLLAPSEEXPAND),c&&(e=a.Node.create('<a href="#"></a>'),e.setHTML(c.getHTML()),e.setAttribute("class",c.getAttribute("class")),e.setAttribute("role","button"),f=[],g.all(d.FIELDSETLEGENDLINK).each(function(a){f[f.length]=a.generateID()}),e.setAttribute("aria-controls",f.join(" ")),e.on("click",this.set_state_all,this,!0),e.on("key",this.set_state_all,"down:enter,32",this,!0),c.replace(e),this.update_btns(g)))},process_fieldset:function(b){var c=b.one(d.LEGENDFTOGGLER),f=a.Node.create('<a href="#"></a>');return f.addClass(e.FHEADER),f.appendChild(c.get("firstChild")),f.setAttribute("role","button"),f.setAttribute("aria-controls",b.generateID()),c.ancestor(d.COLLAPSED)?f.setAttribute("aria-expanded","false"):f.setAttribute("aria-expanded","true"),c.prepend(f),this},set_state:function(a,b){var c=a.one(d.FHEADER);b?(a.addClass(e.COLLAPSED),c&&c.setAttribute("aria-expanded","false")):(a.removeClass(e.COLLAPSED),c&&c.setAttribute("aria-expanded","true"));var f=this.form.one("input[name=mform_isexpanded_"+a.get("id")+"]");return f?(f.set("value",b?0:1),this):this},set_state_all:function(a){a.preventDefault();var b=a.target.hasClass(e.COLLAPSEALL),c=this.form.all(d.FIELDSETCOLLAPSIBLE);c.each(function(a){this.set_state(a,b)},this),this.update_btns()},switch_state:function(a){a.preventDefault();var b=a.target.ancestor(d.FIELDSETCOLLAPSIBLE);this.set_state(b,!b.hasClass(e.COLLAPSED)),this.update_btns()},update_btns:function(){var a,b,c=0,f=!1;return(a=this.form.one(d.COLLAPSEEXPAND))?(b=this.form.all(d.FIELDSETCOLLAPSIBLE),b.each(function(a){a.hasClass(e.COLLAPSED)&&c++}),0!==c&&(f=!0),f?(a.removeClass(e.COLLAPSEALL),a.setHTML(M.util.get_string("expandall","moodle"))):(a.addClass(e.COLLAPSEALL),a.setHTML(M.util.get_string("collapseall","moodle"))),this):this},expand_fieldset:function(b){b.stopPropagation();var c=b.formid;if(c===this.form.getAttribute("id")){var d=a.one("#"+b.elementid).ancestor("fieldset");d&&this.set_state(d,!1)}}},{NAME:"moodle-form-shortforms",ATTRS:f}),M.form=M.form||{},M.form.shortforms=M.form.shortforms||function(a){return new c(a)}},"@VERSION@",{requires:["node","base","selector-css3","moodle-core-event"]});