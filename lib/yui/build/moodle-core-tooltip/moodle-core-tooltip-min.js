YUI.add("moodle-core-tooltip",function(a,b){function c(a){a||(a={}),"undefined"==typeof a.draggable&&(a.draggable=!0),"undefined"==typeof a.constrain&&(a.constrain=!0),c.superclass.constructor.apply(this,[a])}var d={CLOSEBUTTON:".closebutton"},e={PANELTEXT:"tooltiptext"},f={WAITICON:{pix:"i/loading_small",component:"moodle"}},g={};c.NAME="moodle-core-tooltip",c.CSS_PREFIX="moodle-dialogue",c.ATTRS=g,g.initialheadertext={value:""},g.initialbodytext={value:"",setter:function(b){var c,d;return c=a.Node.create("<div />").addClass(e.PANELTEXT),d=a.Node.create("<img />").setAttribute("src",M.util.image_url(f.WAITICON.pix,f.WAITICON.component)).addClass("spinner"),b?(c.set("text",b),d.addClass("iconsmall")):c.addClass("content-lightbox"),c.append(d),c}},g.initialfootertext={value:null,setter:function(b){if(b)return a.Node.create("<div />").set("text",b)}},g.headerhandler={value:"set_header_content"},g.bodyhandler={value:"set_body_content"},g.footerhandler={value:null},g.urlmodifier={value:null},g.textcache={value:null},g.textcachesize={value:10},a.extend(c,M.core.dialogue,{bb:null,listenevents:[],textcache:null,alignpoints:[a.WidgetPositionAlign.TL,a.WidgetPositionAlign.RC],initializer:function(){return this.get("headerhandler")||this.set("headerhandler",this.set_header_content),this.get("bodyhandler")||this.set("bodyhandler",this.set_body_content),this.get("footerhandler")||this.set("footerhandler",function(){}),this.get("urlmodifier")||this.set("urlmodifier",this.modify_url),this.setAttrs({headerContent:this.get("initialheadertext"),bodyContent:this.get("initialbodytext"),footerContent:this.get("initialfootertext")}),this.hide(),this.render(),this.bb=this.get("boundingBox"),this.bb.addClass("moodle-dialogue-tooltip"),window.right_to_left()&&(this.alignpoints=[a.WidgetPositionAlign.TR,a.WidgetPositionAlign.LC]),this.get("textcache")||this.set("textcache",new a.Cache({max:this.get("textcachesize")})),M.cfg.developerdebug&&this.get("textcache").set("max",0),this},display_panel:function(b){var c,e,f,g,h;b.preventDefault(),this.cancel_events(),c=b.target.ancestor("a",!0),this.setAttrs({headerContent:this.get("initialheadertext"),bodyContent:this.get("initialbodytext"),footerContent:this.get("initialfootertext")}),this.show(b),this.align(c,this.alignpoints),e=this.bb.delegate("click",this.close_panel,d.CLOSEBUTTON,this),this.listenevents.push(e),e=a.one("body").on("key",this.close_panel,"esc",this),this.listenevents.push(e),e=this.bb.on("mousedownoutside",this.close_panel,this),this.listenevents.push(e),f=a.bind(this.get("urlmodifier"),this,c.get("href"))(),h=this.get("textcache").retrieve(f),h?this._set_panel_contents(h.response):(g={method:"get",context:this,sync:!1,on:{complete:function(a,b){this._set_panel_contents(b.responseText,f)}}},a.io(f,g))},_set_panel_contents:function(b,c){var d;try{if(d=a.JSON.parse(b),d.error)return this.close_panel(),a.use("moodle-core-notification-ajaxexception",function(){return new M.core.ajaxException(d).show()}),this}catch(e){return this.close_panel(),a.use("moodle-core-notification-exception",function(){return new M.core.exception(e).show()}),this}a.bind(this.get("headerhandler"),this,d)(),a.bind(this.get("bodyhandler"),this,d)(),a.bind(this.get("footerhandler"),this,d)(),c&&this.get("textcache").add(c,b),this.get("buttons").header[0].focus()},set_header_content:function(a){this.set("headerContent",a.heading)},set_body_content:function(b){var c=a.Node.create("<div />").set("innerHTML",b.text).setAttribute("role","alert").addClass(e.PANELTEXT);this.set("bodyContent",c)},modify_url:function(a){return a.replace(/\.php\?/,"_ajax.php?")},close_panel:function(a){this.hide(a),this.cancel_events(),a&&a.preventDefault()},cancel_events:function(){for(var a;this.listenevents.length;)a=this.listenevents.shift(),a.detach()}}),a.Base.modifyAttrs(c,{modal:{value:!1},focusOnPreviousTargetAfterHide:{value:!0}}),M.core=M.core||{},M.core.tooltip=M.core.tooltip=c},"@VERSION@",{requires:["base","node","io-base","moodle-core-notification-dialogue","json-parse","widget-position","widget-position-align","event-outside","cache-base"]});