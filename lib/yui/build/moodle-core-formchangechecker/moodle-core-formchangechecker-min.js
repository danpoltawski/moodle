YUI.add("moodle-core-formchangechecker",function(a,b){var c="core-formchangechecker",d=function(){d.superclass.constructor.apply(this,arguments)};a.extend(d,a.Base,{initialvaluelisteners:[],initializer:function(){var b="form#"+this.get("formid"),c=a.one(b);c&&(a.on(M.core.event.EDITOR_CONTENT_RESTORED,M.core_formchangechecker.reset_form_dirty_state,this),c.delegate("change",M.core_formchangechecker.set_form_changed,"input",this),c.delegate("change",M.core_formchangechecker.set_form_changed,"textarea",this),c.delegate("change",M.core_formchangechecker.set_form_changed,"select",this),this.initialvaluelisteners.push(c.delegate("focus",this.store_initial_value,"input",this)),this.initialvaluelisteners.push(c.delegate("focus",this.store_initial_value,"textarea",this)),this.initialvaluelisteners.push(c.delegate("focus",this.store_initial_value,"select",this)),a.one(b).on("submit",M.core_formchangechecker.set_form_submitted,this),window.onbeforeunload=M.core_formchangechecker.report_form_dirty_state)},store_initial_value:function(a){var b;if(!a.target.hasClass("ignoredirty")&&!a.target.ancestor(".ignoredirty"))if(M.core_formchangechecker.get_form_dirty_state())for(;this.initialvaluelisteners.length;)b=this.initialvaluelisteners.shift(),b.detach();else M.core_formchangechecker.stateinformation.focused_element={element:a.target,initial_value:a.target.get("value")}}},{NAME:c,ATTRS:{formid:{value:""}}}),M.core_formchangechecker=M.core_formchangechecker||{},M.core_formchangechecker.instances=M.core_formchangechecker.instances||[],M.core_formchangechecker.init=function(a){var b=new d(a);return M.core_formchangechecker.instances.push(b),b},M.core_formchangechecker.stateinformation=[],M.core_formchangechecker.set_form_changed=function(a){a&&a.target&&(a.target.hasClass("ignoredirty")||a.target.ancestor(".ignoredirty"))||(M.core_formchangechecker.stateinformation.formchanged=1,delete M.core_formchangechecker.stateinformation.focused_element)},M.core_formchangechecker.set_form_submitted=function(){M.core_formchangechecker.stateinformation.formsubmitted=1},M.core_formchangechecker.get_form_dirty_state=function(){var a,b=M.core_formchangechecker.stateinformation;if(b.formsubmitted)return 0;if(b.formchanged)return 1;if(b.focused_element&&b.focused_element.element.get("value")!==b.focused_element.initial_value)return 1;if("undefined"!=typeof window.tinyMCE)for(a in window.tinyMCE.editors)if(window.tinyMCE.editors[a].isDirty())return 1;return 0},M.core_formchangechecker.reset_form_dirty_state=function(){M.core_formchangechecker.stateinformation.formsubmitted=!1,M.core_formchangechecker.stateinformation.formchanged=!1},M.core_formchangechecker.report_form_dirty_state=function(a){if(M.core_formchangechecker.get_form_dirty_state()){var b=M.util.get_string("changesmadereallygoaway","moodle");if(!M.cfg.behatsiterunning)return a&&(a.returnValue=b),b}}},"@VERSION@",{requires:["base","event-focus","moodle-core-event"]});