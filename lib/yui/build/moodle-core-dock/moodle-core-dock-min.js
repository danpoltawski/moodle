YUI.add("moodle-core-dock",function(a,b){var c,d,e,f,g,h=a.one(a.config.doc.body),i={dock:"dock",dockspacer:"dockspacer",controls:"controls",body:"has_dock",buttonscontainer:"buttons_container",dockeditem:"dockeditem",dockeditemcontainer:"dockeditem_container",dockedtitle:"dockedtitle",activeitem:"activeitem",dockonload:"dock_on_load"},j={dockableblock:".block[data-instanceid][data-dockable]",blockmoveto:".block[data-instanceid][data-dockable] .moveto",panelmoveto:"#dockeditempanel .commands a.moveto",dockonload:".block."+i.dockonload,blockregion:"[data-blockregion]"};M.core=M.core||{},M.core.dock=M.core.dock||{},M.core.dock._dock=null,M.core.dock._dockableblocks={},M.core.dock.init=function(){a.all(j.dockableblock).each(M.core.dock.registerDockableBlock),a.Global.on(M.core.globalEvents.BLOCK_CONTENT_UPDATED,function(a){M.core.dock.notifyBlockChange(a.instanceid)},this),h.delegate("click",M.core.dock.dockBlock,j.blockmoveto),h.delegate("key",M.core.dock.dockBlock,j.blockmoveto,"enter")},M.core.dock.get=function(){return null===this._dock&&(this._dock=new c),this._dock},M.core.dock.registerDockableBlock=function(a){"object"==typeof a&&"function"==typeof a.getData&&(a=a.getData("instanceid")),M.core.dock._dockableblocks[a]=new f({id:a})},M.core.dock.dockBlock=function(a){if("object"==typeof a&&"undefined"!==a.target&&(a=a.target),"object"==typeof a){if(a.test(j.dockableblock)||(a=a.ancestor(j.dockableblock)),"object"!=typeof a||"function"!=typeof a.getData||a.ancestor("."+i.dock))return;a=a.getData("instanceid")}var b=M.core.dock._dockableblocks[a];b&&b.moveToDock()},M.core.dock.fixTitleOrientation=function(b,c){var d,e,f,g,i=M.core.dock.get(),j="11px",k="rotate(270deg)",l=M.util.get_string("thisdirectionvertical","langconfig");if(b=a.one(b),"vertical"!==i.get("orientation"))return b.set("innerHTML",c),b;switch(a.UA.ie>0&&a.UA.ie<8&&(l="ver"),l){case"ver":return b.set("innerHTML",c.split("").join("<br />"));case"ttb":k="rotate(90deg)";break;case"btt":}return 8===a.UA.ie?(b.set("innerHTML",c),b.setAttribute("style","writing-mode: tb-rl; filter: flipV flipH;display:inline;"),b.addClass("filterrotate"),b):(d=a.Node.create('<h2 class="transform-test-heading"><span class="transform-test-node" style="font-size:'+j+';">'+c+"</span></h2>"),h.insert(d,0),e=1.2*d.one("span").get("offsetWidth"),f=d.one("span").get("offsetHeight"),d.remove(),b.set("innerHTML",c),b.addClass("css3transform"),b.setStyles({position:"relative",fontSize:j,width:e,top:(e-f)/2}),window.right_to_left()?b.setStyle("left",e/2-f):b.setStyle("right",e/2-f),b.setStyles({transform:k,"-ms-transform":k,"-moz-transform":k,"-webkit-transform":k,"-o-transform":k}),g=a.Node.create("<div></div>"),g.append(b),g.setStyles({height:e+e/4,position:"relative"}),g)},M.core.dock.notifyBlockChange=function(a){if(null!==this._dock){var b=M.core.dock.get(),c=b.getActiveItem();c&&c.get("blockinstanceid")===parseInt(a,10)&&b.resizePanelIfRequired()}},c=function(){c.superclass.constructor.apply(this,arguments)},c.prototype={tabheightmanager:null,preventevent:null,delayedevent:null,dockeditems:[],dockdrawn:!1,count:0,totalcount:0,holdingareanode:null,initializer:function(){this.publish("dock:starting",{prefix:"dock",broadcast:2,emitFacade:!0,fireOnce:!0}),this.publish("dock:initialised",{prefix:"dock",broadcast:2,emitFacade:!0,fireOnce:!0}),this.publish("dock:beforedraw",{prefix:"dock",fireOnce:!0}),this.publish("dock:beforeshow",{prefix:"dock"}),this.publish("dock:shown",{prefix:"dock",broadcast:2}),this.publish("dock:hidden",{prefix:"dock",broadcast:2}),this.publish("dock:itemadded",{prefix:"dock"}),this.publish("dock:itemremoved",{prefix:"dock"}),this.publish("dock:itemschanged",{prefix:"dock",broadcast:2}),this.publish("dock:panelgenerated",{prefix:"dock",fireOnce:!0}),this.publish("dock:panelresizestart",{prefix:"dock"}),this.publish("dock:resizepanelcomplete",{prefix:"dock"}),this._applyThemeCustomisation(),this.fire("dock:starting"),this._ensureDockDrawn(),this.fire("dock:initialised")},_ensureDockDrawn:function(){if(this.dockdrawn===!0)return!0;var b=this._initialiseDockNode(),c={cssselector:"."+i.dockedtitle,delay:0},d={cssselector:"."+i.dockedtitle,delay:.5,iscontained:!0,preventevent:"click",preventdelay:3};return a.UA.ie>0&&a.UA.ie<7&&b.setStyle("height",b.get("winHeight")+"px"),this.fire("dock:beforedraw"),this._initialiseDockControls(),this.tabheightmanager=new e({dock:this}),a.delegate("click",this.handleEvent,this.get("dockNode"),"."+i.dockedtitle,this,c),a.delegate("mouseenter",this.handleEvent,this.get("dockNode"),"."+i.dockedtitle,this,d),this.get("dockNode").on("mouseleave",this.handleEvent,this,{cssselector:"#dock",delay:.5,iscontained:!1}),a.delegate("click",this.handleReturnToBlock,this.get("dockNode"),j.panelmoveto,this),a.delegate("dock:actionkey",this.handleDockedItemEvent,this.get("dockNode"),"."+i.dockeditem,this),h.on("click",this.handleEvent,this,{cssselector:"body",delay:0}),this.on("dock:itemschanged",this.resizeBlockSpace,this),this.on("dock:itemschanged",this.checkDockVisibility,this),this.on("dock:itemschanged",this.resetFirstItem,this),this.dockdrawn=!0,!0},handleDockedItemEvent:function(a){if("dock:actionkey"!==a.type)return!1;var b=a.target,c="."+i.dockeditem;return b.test(c)||(b=b.ancestor(c)),!!b&&(a.halt(),void this.dockeditems[b.getAttribute("rel")].toggle(a.action))},_applyThemeCustomisation:function(){if("function"==typeof customise_dock_for_theme){M.core_dock=this,M.core_dock.cfg={buffer:null,orientation:null,position:null,spacebeforefirstitem:null,removeallicon:null},M.core_dock.css={dock:null,dockspacer:null,controls:null,body:null,buttonscontainer:null,dockeditem:null,dockeditemcontainer:null,dockedtitle:null,activeitem:null};try{window.customise_dock_for_theme(this)}catch(b){}var c,d,e=!1,f={buffer:"bufferPanel",orientation:"orientation",position:"position",spacebeforefirstitem:"bufferBeforeFirstItem",removeallicon:"undockAllIconUrl"};for(c in M.core_dock.cfg)if(a.Lang.isString(c)&&f[c]){if(d=M.core_dock.cfg[c],null===d)continue;e||(e=!0),this.set(f[c],d)}for(c in M.core_dock.css)if(a.Lang.isString(c)){if(d=M.core_dock.css[c],null===d)continue;e||(e=!0),i[c]=d}}},_initialiseDockNode:function(){var b=this.get("dockNode"),c=i.dock+"_"+this.get("position")+"_"+this.get("orientation"),d=a.Node.create("<div></div>").setStyles({display:"none"}),e=this.get("buttonsNode"),f=this.get("itemContainerNode");return b||(b=a.one("#"+i.dock)),b||(b=a.Node.create('<div id="'+i.dock+'"></div>'),h.append(b)),b.setAttribute("role","menubar").addClass(c),0===a.all(j.dockonload).size()?b.addClass("nothingdocked"):(c=i.body+"_"+this.get("position")+"_"+this.get("orientation"),h.addClass(i.body).addClass()),e||(e=b.one("."+i.buttonscontainer)),e||(e=a.Node.create('<div class="'+i.buttonscontainer+'"></div>'),b.append(e)),f||(f=b.one("."+i.dockeditemcontainer)),f||(f=a.Node.create('<div class="'+i.dockeditemcontainer+'"></div>'),e.append(f)),h.append(d),this.holdingareanode=d,this.set("dockNode",b),this.set("buttonsNode",e),this.set("itemContainerNode",f),b},_initialiseDockControls:function(){var b=a.Node.create('<img alt="'+M.util.get_string("undockall","block")+'" tabindex="0" />');b.setAttribute("src",this.get("undockAllIconUrl")),b.on("removeall|click",this.removeAll,this),b.on("dock:actionkey",this.removeAll,this,{actions:{enter:!0}}),this.get("buttonsNode").append(a.Node.create('<div class="'+i.controls+'"></div>').append(b))},getPanel:function(){var b=this.get("panel");return b||(b=new d({dock:this}),b.on("panel:visiblechange",this.resize,this),a.on("windowresize",this.resize,this),this.set("panel",b),this.fire("dock:panelgenerated")),b},resizePanelIfRequired:function(){this.resize();var a=this.get("panel");a&&a.correctWidth()},handleEvent:function(a,b){var c,d,e=this.getActiveItem(),f=/^dock_item_(\d+)_title$/,g=this;if("body"===b.cssselector)this.get("dockNode").contains(a.target)||e&&e.hide();else{if(c=a.target.test(b.cssselector)?a.target:a.target.ancestor(b.cssselector),!c)return!0;if(null!==this.preventevent&&a.type===this.preventevent)return!0;if(b.preventevent&&(this.preventevent=b.preventevent,b.preventdelay&&setTimeout(function(){g.preventevent=null},1e3*b.preventdelay)),this.delayedevent&&this.delayedevent.timeout&&(clearTimeout(this.delayedevent.timeout),this.delayedevent.event.detach(),this.delayedevent=null),b.delay>0)return this.delayEvent(a,b,c);d=c.get("id"),d.match(f)?(e=this.dockeditems[d.replace(f,"$1")],e.active?e.hide():e.show()):e&&e.hide()}return!0},delayEvent:function(a,b,c){var d=this;return d.delayedevent=function(){return{target:c,event:h.on("mousemove",function(a){d.delayedevent.target=a.target}),timeout:null}}(d),d.delayedevent.timeout=setTimeout(function(){d.delayedevent.timeout=null,d.delayedevent.event.detach(),b.iscontained===d.get("dockNode").contains(d.delayedevent.target)&&d.handleEvent(a,{cssselector:b.cssselector,delay:0,iscontained:b.iscontained})},1e3*b.delay),!0},resizeBlockSpace:function(){if(!(a.all(j.dockonload).size()>0)){var b=0,c=[],d=[],e=!1,f=[],g=!1,i=[],k=[];a.all(j.blockregion).each(function(a){var e=a.getData("blockregion");a.all(".block").size()>0?(c.push(e),b++):a.all(".block_dock_placeholder").size()>0&&d.push(e)}),a.all(".block-region").each(function(a){if(!a.test(j.blockregion)){g=!0;var c=a.get("id").replace(/^region\-/,"side-"),d=a.all(".block").size()>0;d?(f.push(c),b++):k.push(c+"-only")}}),h.hasClass("blocks-moving")&&(e=!0),a.each(d,function(a){i.push("empty-region-"+a,"docked-region-"+a),k.push("used-region-"+a,a+"-only")},this),a.each(c,function(a){i.push("used-region-"+a),k.push("empty-region-"+a,"docked-region-"+a),1===b&&e===!1?i.push(a+"-only"):k.push(a+"-only")},this),g&&(e||1!==b?a.each(f,function(a){k.push(a+"-only")}):a.each(f,function(a){i.push(a+"-only")})),h.hasClass("has-region-content")||(0===b&&e===!1?i.push("content-only"):k.push("content-only")),a.each(k,function(a){h.removeClass(a)}),a.each(i,function(a){h.addClass(a)})}},add:function(a){a.set("id",this.totalcount),this.count++,this.totalcount++,this.dockeditems[a.get("id")]=a,this.dockeditems[a.get("id")].draw(),this.fire("dock:itemadded",a),this.fire("dock:itemschanged",a)},append:function(a){this.get("itemContainerNode").append(a)},handleReturnToBlock:function(a){a.halt(),this.remove(this.getActiveItem().get("id"))},remove:function(a){return!!this.dockeditems[a]&&(this.dockeditems[a].remove(),delete this.dockeditems[a],this.count--,this.fire("dock:itemremoved",a),this.fire("dock:itemschanged",a),!0)},resetFirstItem:function(){this.get("dockNode").all("."+i.dockeditem+".firstdockitem").removeClass("firstdockitem"),this.get("dockNode").one("."+i.dockeditem)&&this.get("dockNode").one("."+i.dockeditem).addClass("firstdockitem")},removeAll:function(){var b;for(b in this.dockeditems)(a.Lang.isNumber(b)||a.Lang.isString(b))&&this.remove(b);return!0},hideActive:function(){var a=this.getActiveItem();a&&a.hide()},checkDockVisibility:function(){var a=i.body+"_"+this.get("position")+"_"+this.get("orientation");this.count?(this.fire("dock:beforeshow"),this.get("dockNode").removeClass("nothingdocked"),h.addClass(i.body).addClass(a),this.fire("dock:shown")):(this.get("dockNode").addClass("nothingdocked"),h.removeClass(i.body).removeClass(),this.fire("dock:hidden"))},resize:function(){var b,c,d,e,f,g,i,j,k,l,m=this.getPanel(),n=this.getActiveItem();return!m.get("visible")||!n||(this.fire("dock:panelresizestart"),"vertical"===this.get("orientation")&&(b=this.get("bufferPanel"),c=parseInt(h.get("winHeight"),10)-2*b,d=this.get("dockNode").getY(),e=n.get("dockTitleNode").getY()-d-b,f=this.get("itemContainerNode").getY(),g=f-d+this.get("buttonsNode").get("offsetHeight"),i=m.get("bodyNode").get("scrollTop"),m.get("bodyNode").setStyle("height","auto"),m.get("node").removeClass("oversized_content"),j=m.get("node").get("offsetHeight"),a.UA.ie>0&&a.UA.ie<7?m.setTop(n.get("dockTitleNode").getY()):j>c?(m.setTop(b-g),m.get("bodyNode").setStyle("height",c-m.get("headerNode").get("offsetHeight")+"px"),m.get("node").addClass("oversized_content")):j>c-(e-b)?m.setTop(e-g-(j-(c-e))+b):m.setTop(e-g+b),i&&m.get("bodyNode").set("scrollTop",i)),"right"===this.get("position")?m.get("node").setStyle("left","-"+m.get("node").get("offsetWidth")+"px"):"top"===this.get("position")&&(k=this.get("dockNode").getX(),l=n.get("dockTitleNode").getX()-k,m.get("node").setStyle("left",l+"px")),this.fire("dock:resizepanelcomplete"),!0)},getActiveItem:function(){var a;for(a in this.dockeditems)if(this.dockeditems[a].active)return this.dockeditems[a];return!1},addToHoldingArea:function(a){this.holdingareanode.append(a)}},a.extend(c,a.Base,c.prototype,{NAME:"moodle-core-dock",ATTRS:{dockNode:{writeOnce:!0},panel:{writeOnce:!0},buttonsNode:{writeOnce:!0},itemContainerNode:{writeOnce:!0},bufferPanel:{value:10,validator:a.Lang.isNumber},position:{value:"left",validator:a.Lang.isString},orientation:{value:"vertical",validator:a.Lang.isString,setter:function(a){return a.match(/^vertical$/i)?"vertical":"horizontal"}},bufferBeforeFirstItem:{value:10,validator:a.Lang.isNumber},undockAllIconUrl:{value:M.util.image_url(window.right_to_left()?"t/dock_to_block_rtl":"t/dock_to_block","moodle"),validator:a.Lang.isString}}}),a.augment(c,a.EventTarget),d=function(){d.superclass.constructor.apply(this,arguments)},d.prototype={created:!1,initializer:function(){this.publish("dockpanel:beforeshow",{prefix:"dockpanel"}),this.publish("dockpanel:shown",{prefix:"dockpanel"}),this.publish("dockpanel:beforehide",{prefix:"dockpanel"}),this.publish("dockpanel:hidden",{prefix:"dockpanel"}),this.publish("dockpanel:visiblechange",{prefix:"dockpanel"})},create:function(){if(this.created)return!0;this.created=!0;var b=this.get("dock"),c=b.get("dockNode");this.set("node",a.Node.create('<div id="dockeditempanel" class="dockitempanel_hidden"></div>')),this.set("contentNode",a.Node.create('<div class="dockeditempanel_content"></div>')),this.set("headerNode",a.Node.create('<div class="dockeditempanel_hd"></div>')),this.set("bodyNode",a.Node.create('<div class="dockeditempanel_bd"></div>')),c.append(this.get("node").append(this.get("contentNode").append(this.get("headerNode")).append(this.get("bodyNode"))))},show:function(){this.create(),this.fire("dockpanel:beforeshow"),this.set("visible",!0),this.get("node").removeClass("dockitempanel_hidden"),this.fire("dockpanel:shown"),this.fire("dockpanel:visiblechange")},hide:function(){this.fire("dockpanel:beforehide"),this.set("visible",!1),this.get("node").addClass("dockitempanel_hidden"),this.fire("dockpanel:hidden"),this.fire("dockpanel:visiblechange")},setHeader:function(b){this.create();var c,d=this.get("headerNode");if(d.setContent(b),arguments.length>1)for(c=1;c<arguments.length;c++)(a.Lang.isNumber(c)||a.Lang.isString(c))&&d.append(arguments[c])},setBody:function(a){this.create(),this.get("bodyNode").setContent(a)},setTop:function(b){a.UA.ie>0&&a.UA.ie<7?this.get("node").setY(b):this.get("node").setStyle("top",b.toString()+"px")},correctWidth:function(){var a=this.get("bodyNode"),b=a.get("clientWidth"),c=a.get("scrollWidth"),d=a.get("offsetWidth"),e=b,f=Math.round(.8*a.get("winWidth"));c>b&&(e=b+(c-b)+2*(d-b)+10),e>f&&(e=f),e>d&&this.get("node").setStyle("width",e+"px")}},a.extend(d,a.Base,d.prototype,{NAME:"moodle-core-dock-panel",ATTRS:{dock:{writeOnce:"initOnly"},node:{value:null},contentNode:{value:null},headerNode:{value:null},bodyNode:{value:null},visible:{value:!1}}}),a.augment(d,a.EventTarget),e=function(){e.superclass.constructor.apply(this,arguments)},e.prototype={initializer:function(){var b=this.get("dock");b.on("dock:itemschanged",this.checkSizing,this),a.on("windowresize",this.checkSizing,this)},checkSizing:function(){var b,c,d=this.get("dock"),e=d.get("dockNode"),f=d.dockeditems,g=parseInt(e.one(".dockeditem_container").getStyle("marginTop").replace("/[^0-9]+$/",""),10),h=e.get("offsetHeight")-g,j=e.one(".controls").get("offsetHeight"),k=3*d.get("bufferPanel"),l=h-j-k-2*f.length,m=0;if(f.length>0){for(b in f)(a.Lang.isNumber(b)||a.Lang.isString(b))&&(c=a.one(f[b].get("title")).ancestor("."+i.dockedtitle),c&&(this.get("enabled")&&c.setStyle("height","auto"),m+=c.get("offsetHeight")||0));m>l&&this.enable(l)}},enable:function(b){var c,d,e,f,g=this.get("dock"),h=g.dockeditems,j=g.count,k=0,l=0;this.set("enabled",!0);for(c in h)if(a.Lang.isNumber(c)||a.Lang.isString(c)){if(d=a.one(h[c].get("title")).ancestor("."+i.dockedtitle),!d)continue;e=Math.floor((b-l)/(j-k)),f=d.get("offsetHeight"),d.setStyle("overflow","hidden"),f>e?(d.setStyle("height",e+"px"),l+=e):l+=f,k++}}},a.extend(e,a.Base,e.prototype,{NAME:"moodle-core-tabheightmanager",ATTRS:{dock:{writeOnce:"initOnly"},enabled:{value:!1}}}),a.Event.define("dock:actionkey",{_event:a.UA.webkit||a.UA.ie?"keydown":"keypress",_keys:{37:"collapse",39:"expand",32:"toggle",13:"enter"},_keyHandler:function(a,b,c){var d;d=c.actions?c.actions:{collapse:!0,expand:!0,toggle:!0,enter:!0},this._keys[a.keyCode]&&d[this._keys[a.keyCode]]&&(a.action=this._keys[a.keyCode],b.fire(a))},on:function(a,b,c){null===b.args?b._detacher=a.on(this._event,this._keyHandler,this,c,{actions:!1}):b._detacher=a.on(this._event,this._keyHandler,this,c,b.args[0])},detach:function(a,b){b._detacher.detach()},delegate:function(a,b,c,d){null===b.args?b._delegateDetacher=a.delegate(this._event,this._keyHandler,d,this,c,{actions:!1}):b._delegateDetacher=a.delegate(this._event,this._keyHandler,d,this,c,b.args[0])},detachDelegate:function(a,b){b._delegateDetacher.detach()}}),f=function(){f.superclass.constructor.apply(this,arguments)},f.prototype={contentplaceholder:null,contentskipanchor:null,cachedcontentnode:null,skipsetposition:!0,dockitem:null,initializer:function(){var b=a.one("#inst"+this.get("id"));return!!b&&(M.core.dock.ensureMoveToIconExists(b),b.hasClass(i.dockonload)&&(b.removeClass(i.dockonload),this.moveToDock()),this.skipsetposition=!1,!0)},_getBlockClass:function(b){var c,d,e=b.getData("block");return a.Lang.isString(e)&&""!==e?e:(c=b.getAttribute("className").toString(),d=/(^| )block_([^ ]+)/.exec(c),d?d[2]:d)},moveToDock:function(b){b&&b.halt(!0);var c,d,e,f,h=M.core.dock.get(),i=this.get("id"),j=a.one("#inst"+i).one(".content"),k=window.right_to_left()?"t/dock_to_block_rtl":"t/dock_to_block",l=location.href.match(/\?/)?"&":"?";j&&(this.recordBlockState(),c=this.cachedcontentnode.one(".title h2").cloneNode(!0),d=this.cachedcontentnode.one(".title .commands"),d=d?d.cloneNode(!0):a.Node.create('<div class="commands"></div>'),e=a.Node.create("<img />").setAttrs({alt:a.Escape.html(M.util.get_string("undockitem","block")),title:a.Escape.html(M.util.get_string("undockblock","block",c.get("innerHTML"))),src:M.util.image_url(k,"moodle")}),f=a.Node.create('<a class="moveto customcommand requiresjs"></a>').setAttrs({href:a.config.win.location.href+l+"dock="+i}),f.append(e),d.append(f.append(e)),this.dockitem=new g({block:this,dock:h,blockinstanceid:i,title:c,contents:j,commands:d,blockclass:this._getBlockClass(a.one("#inst"+i))}),h.add(this.dockitem),this.skipsetposition||M.util.set_user_preference("docked_block_instance_"+i,1),this.set("isDocked",!0))},recordBlockState:function(){var b=this.get("id"),c=M.core.dock.get(),d=a.one("#inst"+b),e=d.previous();e.hasClass("skip-block")&&(this.contentskipanchor=e,this.contentskipanchor.hide()),this.cachedcontentnode=d,this.contentplaceholder=a.Node.create('<div class="block_dock_placeholder"></div>'),d.replace(this.contentplaceholder),c.addToHoldingArea(d),d=null},returnToPage:function(){var a=this.get("id");return this.contentskipanchor&&this.contentskipanchor.show(),this.cachedcontentnode.one(".header")?this.cachedcontentnode.one(".header").insert(this.dockitem.get("contents"),"after"):this.cachedcontentnode.insert(this.dockitem.get("contents")),this.contentplaceholder.replace(this.cachedcontentnode),this.cachedcontentnode=null,M.util.set_user_preference("docked_block_instance_"+a,0),this.set("isDocked",!1),!0}},a.extend(f,a.Base,f.prototype,{NAME:"moodle-core-dock-block",ATTRS:{id:{writeOnce:"initOnly",setter:function(a){return parseInt(a,10)}},isDocked:{value:!1}}}),g=function(){g.superclass.constructor.apply(this,arguments)},g.prototype={active:!1,initializer:function(){var b,c,d=this.get("title");this.publish("dockeditem:drawstart",{prefix:"dockeditem"}),this.publish("dockeditem:drawcomplete",{prefix:"dockeditem"}),this.publish("dockeditem:showstart",{prefix:"dockeditem"}),this.publish("dockeditem:showcomplete",{prefix:"dockeditem"}),this.publish("dockeditem:hidestart",{prefix:"dockeditem"}),this.publish("dockeditem:hidecomplete",{prefix:"dockeditem"}),this.publish("dockeditem:itemremoved",{prefix:"dockeditem"}),d&&(c=d.get("nodeName"),b=d.cloneNode(!0),d=a.Node.create("<"+c+"></"+c+">"),d=M.core.dock.fixTitleOrientation(d,b.get("text")),this.set("title",d),this.set("titlestring",b))},draw:function(){var b,c,d,e,f=a.Node.create,g=this.get("dock"),h=g.count,j=this.get("id");return this.fire("dockeditem:drawstart"),b=f('<div id="dock_item_'+j+'_title" role="menu" aria-haspopup="true" class="'+i.dockedtitle+'"></div>'),b.append(this.get("title")),c=f('<div id="dock_item_'+j+'" class="'+i.dockeditem+'" tabindex="0" rel="'+j+'"></div>'),1===h&&c.addClass("firstdockitem"),c.append(b),g.append(c),e=f('<img alt="'+M.util.get_string("hidepanel","block")+'" title="'+M.util.get_string("hidedockpanel","block")+'" />'),e.setAttribute("src",M.util.image_url("t/dockclose","moodle")),d=f('<span class="hidepanelicon" tabindex="0"></span>').append(e),d.on("forceclose|click",this.hide,this),d.on("dock:actionkey",this.hide,this,{actions:{enter:!0,toggle:!0}}),this.get("commands").append(d),this.set("dockTitleNode",b),this.set("dockItemNode",c),this.fire("dockeditem:drawcomplete"),!0},show:function(){var b=this.get("dock"),c=b.getPanel(),d=this.get("dockTitleNode");return b.hideActive(),this.fire("dockeditem:showstart"),c.setHeader(this.get("titlestring"),this.get("commands")),c.setBody(a.Node.create('<div class="block_'+this.get("blockclass")+' block_docked"></div>').append(this.get("contents"))),void 0!==M.core.actionmenu&&M.core.actionmenu.newDOMNode(c.get("node")),c.show(),c.correctWidth(),this.active=!0,d.addClass(i.activeitem),d.set("aria-expanded","true"),this.fire("dockeditem:showcomplete"),b.resize(),!0},hide:function(){this.fire("dockeditem:hidestart"),this.active&&(this.active=!1,this.get("dock").getPanel().hide()),this.get("dockTitleNode").removeClass(i.activeitem).set("aria-expanded","false"),this.fire("dockeditem:hidecomplete")},toggle:function(a){var b=this.get("dockTitleNode");b.hasClass(i.activeitem)&&"expand"!==a?this.hide():b.hasClass(i.activeitem)||"collapse"===a||this.show()},remove:function(){this.hide(),this.get("block").returnToPage(),this.get("dockItemNode").remove(),this.fire("dockeditem:itemremoved")},_getLogDescription:function(){return this.get("titlestring").get("innerHTML")+" ("+this.get("blockinstanceid")+")"}},a.extend(g,a.Base,g.prototype,{NAME:"moodle-core-dock-dockeditem",ATTRS:{block:{writeOnce:"initOnly"},dock:{writeOnce:"initOnly"},id:{},blockinstanceid:{writeOnce:"initOnly",setter:function(a){return parseInt(a,10)}},title:{value:null},titlestring:{value:null},contents:{writeOnce:"initOnly"},commands:{writeOnce:"initOnly"},blockclass:{writeOnce:"initOnly"},dockTitleNode:{value:null},dockItemNode:{value:null},dockcontainerNode:{value:null}}}),a.augment(g,a.EventTarget)},"@VERSION@",{requires:["base","node","event-custom","event-mouseenter","event-resize","escape","moodle-core-dock-loader","moodle-core-event"]});