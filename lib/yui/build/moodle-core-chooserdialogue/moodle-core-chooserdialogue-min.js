YUI.add("moodle-core-chooserdialogue",function(a,b){var c=function(){c.superclass.constructor.apply(this,arguments)};a.extend(c,a.Base,{panel:null,submitbutton:null,container:null,listenevents:[],bodycontent:null,headercontent:null,instanceconfig:null,hiddenRadioValue:null,setup_chooser_dialogue:function(a,b,c){this.bodycontent=a,this.headercontent=b,this.instanceconfig=c},prepare_chooser:function(){if(!this.panel){a.one(a.config.doc.body).addClass("jschooser");var b,c={bodyContent:this.bodycontent.get("innerHTML"),headerContent:this.headercontent.get("innerHTML"),width:"540px",draggable:!0,visible:!1,zindex:100,modal:!0,shim:!0,closeButtonTitle:this.get("closeButtonTitle"),focusOnPreviousTargetAfterHide:!0,render:!1,extraClasses:this._getClassNames()};for(b in this.instanceconfig)c[b]=this.instanceconfig[b];this.panel=new M.core.dialogue(c),this.bodycontent.remove(),this.headercontent.remove(),this.panel.hide(),this.panel.render(),this.container=this.panel.get("boundingBox").one(".choosercontainer"),this.options=this.container.all(".option input[type=radio]"),this.hiddenRadioValue=a.Node.create('<input type="hidden" value="" />'),this.container.one("form").appendChild(this.hiddenRadioValue),this.panel.get("boundingBox").addClass("chooserdialogue")}},display_chooser:function(b){var c,d,e;this.prepare_chooser(),b.preventDefault(),c=this.panel.get("boundingBox"),d=this.container.one(".alloptions"),e=a.one("document").on("orientationchange",function(){this.center_dialogue(d)},this),this.listenevents.push(e),e=a.one("window").on("resize",function(){this.center_dialogue(d)},this),this.listenevents.push(e),e=this.container.on("click",this.check_options,this),this.listenevents.push(e),e=this.container.on("key_up",this.check_options,this),this.listenevents.push(e),e=this.container.on("dblclick",function(a){a.target.ancestor("div.option")&&(this.check_options(),this.submitbutton.setAttribute("disabled","disabled"),this.options.setAttribute("disabled","disabled"),this.cancel_listenevents(),this.container.one("form").submit())},this),this.listenevents.push(e),this.container.one("form").on("submit",function(){this.submitbutton.setAttribute("disabled","disabled"),this.options.setAttribute("disabled","disabled"),this.cancel_listenevents()},this),e=this.container.one(".addcancel").on("click",this.cancel_popup,this),this.listenevents.push(e),e=c.one("button.closebutton").on("click",this.cancel_popup,this),this.listenevents.push(e),e=a.one("document").on("keydown",this.handle_key_press,this),this.listenevents.push(e),this.submitbutton=this.container.one(".submitbutton"),this.submitbutton.set("disabled","true"),this.options.removeAttribute("disabled"),this.panel.show(b),this.center_dialogue(d),this.container.one(".option input[type=radio]").focus(),this.check_options()},cancel_listenevents:function(){for(var a;this.listenevents.length;)a=this.listenevents.shift(),a.detach()},center_dialogue:function(a){var b,c,d=this.panel.get("boundingBox"),e=d.get("winHeight");if(!this.panel.shouldResizeFullscreen()){b=this.get("maxheight"),e<=b&&(b=e<=this.get("minheight")?this.get("minheight"):e),b>this.get("minheight")?this.panel.lockScroll&&!this.panel.lockScroll.isActive()&&this.panel.lockScroll.enableScrollLock(!0):this.panel.lockScroll&&this.panel.lockScroll.isActive()&&this.panel.lockScroll.disableScrollLock(),c=b,b-=110,a.setStyle("maxHeight",b+"px");var f=d.getStyle("height");f=f.match(/.*px$/)?f.replace(/px$/,""):c,f<this.get("baseheight")&&(f=this.get("baseheight"),a.setStyle("height",f+"px")),this.panel.centerDialogue()}},handle_key_press:function(a){27===a.keyCode&&this.cancel_popup(a)},cancel_popup:function(a){a.preventDefault(),this.hide()},hide:function(){this.cancel_listenevents(),this.container.detachAll(),this.panel.hide()},check_options:function(){this.options.each(function(a){var b=a.get("parentNode").get("parentNode");a.get("checked")?(b.addClass("selected"),this.option_selected(a),this.submitbutton.removeAttribute("disabled"),a.focus()):b.removeClass("selected")},this)},option_selected:function(a){this.hiddenRadioValue.setAttrs({value:a.get("value"),name:a.get("name")})},_getClassNames:function(a){var b="chooserdialogue-"+this.name,c=[];if(c.push(b.toLowerCase()),a){var d;for(d in a)c.push((b+"-"+d).toLowerCase())}return c}},{NAME:"moodle-core-chooserdialogue",ATTRS:{minheight:{value:300},baseheight:{value:400},maxheight:{value:660},closeButtonTitle:{validator:a.Lang.isString,value:"Close"}}}),M.core=M.core||{},M.core.chooserdialogue=c},"@VERSION@",{requires:["base","panel","moodle-core-notification"]});