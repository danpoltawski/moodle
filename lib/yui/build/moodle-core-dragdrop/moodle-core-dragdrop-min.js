YUI.add("moodle-core-dragdrop",function(a,b){var c={pix:"i/move_2d",largepix:"i/dragdrop",component:"moodle",cssclass:"moodle-core-dragdrop-draghandle"},d=function(){d.superclass.constructor.apply(this,arguments)};a.extend(d,a.Base,{goingup:null,absgoingup:null,samenodeclass:null,parentnodeclass:null,samenodelabel:null,parentnodelabel:null,groups:[],lastdroptarget:null,listeners:null,initializer:function(){this.listeners=[],this.listeners.push(a.DD.DDM.on("drag:start",this.global_drag_start,this)),this.listeners.push(a.DD.DDM.on("drag:end",this.global_drag_end,this)),this.listeners.push(a.DD.DDM.on("drag:drag",this.global_drag_drag,this)),this.listeners.push(a.DD.DDM.on("drop:over",this.global_drop_over,this)),this.listeners.push(a.DD.DDM.on("drop:hit",this.global_drop_hit,this)),this.listeners.push(a.DD.DDM.on("drag:dropmiss",this.global_drag_dropmiss,this)),this.listeners.push(a.one(a.config.doc.body).delegate("key",this.global_keydown,"down:32, enter, esc","."+c.cssclass,this)),this.listeners.push(a.one(a.config.doc.body).delegate("click",this.global_keydown,"."+c.cssclass,this))},destructor:function(){new a.EventHandle(this.listeners).detach()},get_drag_handle:function(b,d,e,f){var g=c.pix;f&&(g=c.largepix);var h=a.Node.create("<img />").setStyle("cursor","move").setAttrs({src:M.util.image_url(g,c.component),alt:b});e&&h.addClass(e);var i=a.Node.create("<span></span>").addClass(d).setAttribute("title",b).setAttribute("tabIndex",0).setAttribute("data-draggroups",this.groups).setAttribute("role","button");return i.appendChild(h),i.addClass(c.cssclass),i},lock_drag_handle:function(a,b){a.removeHandle("."+b)},unlock_drag_handle:function(a,b){a.addHandle("."+b),a.get("activeHandle").focus()},ajax_failure:function(a){var b={name:a.status+" "+a.statusText,message:a.responseText};return new M.core.exception(b)},in_group:function(b){var c=!1;return a.each(this.groups,function(a){b._groups[a]&&(c=!0)},this),c},global_drag_start:function(a){var b=a.target;this.in_group(b)&&(this.originalstyle=b.get("node").getAttribute("style"),b.get("node").setStyle("opacity",".25"),b.get("dragNode").setStyles({opacity:".75",borderColor:b.get("node").getStyle("borderColor"),backgroundColor:b.get("node").getStyle("backgroundColor")}),b.get("dragNode").empty(),this.drag_start(a))},global_drag_end:function(a){var b=a.target;this.in_group(b)&&(b.get("node").setAttribute("style",this.originalstyle),this.drag_end(a))},global_drag_drag:function(a){var b=a.target,c=a.info;this.in_group(b)&&(c.start[1]<c.xy[1]?this.absgoingup=!0:c.start[1]>c.xy[1]&&(this.absgoingup=!1),c.delta[1]<0?this.goingup=!0:c.delta[1]>0&&(this.goingup=!1),this.drag_drag(a))},global_drop_over:function(a){if(a.drop&&a.drop.inGroup(this.groups)){var b=a.drag.get("node"),c=a.drop.get("node");if(this.lastdroptarget=a.drop,c.hasClass(this.samenodeclass)){var d;d=this.goingup?"before":"after",c.insert(b,d)}else!c.hasClass(this.parentnodeclass)&&!c.test('[data-droptarget="1"]')||c.contains(b)||(this.goingup?c.append(b):c.prepend(b));this.drop_over(a)}},global_drag_dropmiss:function(a){a.drag=a.target,a.drop=this.lastdroptarget,this.in_group(a.drag)&&a.drop&&a.drop.inGroup(this.groups)&&this.drag_dropmiss(a)},global_drop_hit:function(a){a.drop&&a.drop.inGroup(this.groups)&&this.drop_hit(a)},find_element_text:function(b){var c="";if(c=b.get("aria-label")||"",c.length>0)return c;var d=b.get("aria-labelledby");if(d){var e=a.one("#"+d);if(e&&e.get("text").length>0)return e.get("text")}var f=b.all("h2, h3, h4, h5, span:not(.actions):not(.menu-action-text), p, div.no-overflow, div.dimmed_text");return f.each(function(){""===c&&""!==a.Lang.trim(this.get("text"))&&(c=this.get("text"))}),""!==c?c:M.util.get_string("emptydragdropregion","moodle")},global_start_keyboard_drag:function(b,c,d){M.core.dragdrop.keydragcontainer=d,M.core.dragdrop.keydraghandle=c;var e=this.find_element_text(d),f=M.util.get_string("movecontent","moodle",e),g=a.Node.create("<ul></ul>");g.addClass("dragdrop-keyboard-drag");var h,i,j,k=a.all("."+this.samenodeclass+", ."+this.parentnodeclass);k.each(function(b){var c=!1,f=b,k=b.getAttribute("class").split(" ").join(", .");if(b.drop&&b.drop.inGroup(this.groups)&&b.drop.get("node")!==d&&b.next(k)!==d)c=!0;else{var l,m,n=b.getAttribute("data-draggroups").split(" ");for(l=0;l<n.length;l++){for(m=0;m<this.groups.length;m++)if(n[l]===this.groups[m]&&b!=d&&b.next(k)!==d&&b.get("children").item(0)!=d){c=!0,f=b.get("parentNode");break}if(c)break}}c&&(h=a.Node.create("<li></li>"),i=a.Node.create("<a></a>"),e=this.find_element_text(f),j=this.samenodelabel&&b.hasClass(this.samenodeclass)?M.util.get_string(this.samenodelabel.identifier,this.samenodelabel.component,e):this.parentnodelabel&&b.hasClass(this.parentnodeclass)?M.util.get_string(this.parentnodelabel.identifier,this.parentnodelabel.component,e):M.util.get_string("tocontent","moodle",e),i.setContent(j),i.setAttribute("data-drop-target",b.get("id")),i.setAttribute("tabindex","0"),i.on("click",this.global_keyboard_drop,this),i.on("key",this.global_keyboard_drop,"down:enter,32",this),h.append(i),g.append(h))},this),M.core.dragdrop.dropui=new M.core.dialogue({headerContent:f,bodyContent:g,draggable:!0,visible:!0,center:!0,modal:!0}),M.core.dragdrop.dropui.after("visibleChange",function(a){a.prevVal&&!a.newVal&&this.global_cancel_keyboard_drag()},this),g.one("a")&&g.one("a").focus()},simulated_drag_drop_event:function(a,b){var c=function(a){this.node=a};c.prototype.get=function(a){return"node"===a||"dragNode"===a||"dropNode"===a?this.node:"activeHandle"===a?this.node.one(".editing_move"):null},c.prototype.inGroup=function(){return!0},c.prototype.addHandle=function(){},c.prototype.removeHandle=function(){},this.drop=new c(b),this.drag=new c(a),this.target=this.drop},global_keyboard_drop:function(b){var c=M.core.dragdrop.keydragcontainer,d=a.one("#"+b.target.getAttribute("data-drop-target"));M.core.dragdrop.dropui.hide(),b.preventDefault();var e=new this.simulated_drag_drop_event(c,c),f=new this.simulated_drag_drop_event(c,d);this.drag_start(e),this.global_drop_over(f),d.hasClass(this.parentnodeclass)&&d.contains(c)&&d.prepend(c),this.global_drop_hit(f)},global_cancel_keyboard_drag:function(){M.core.dragdrop.keydragcontainer&&(M.core.dragdrop.keydraghandle.focus(),M.core.dragdrop.keydragcontainer=null),M.core.dragdrop.dropui&&M.core.dragdrop.dropui.destroy()},global_keydown:function(a){var b,d,e=a.target.ancestor("."+c.cssclass,!0);if(null!==e){if(27===a.keyCode)return this.global_cancel_keyboard_drag(),void a.preventDefault();if(e.hasClass(c.cssclass)&&(13===a.keyCode||32===a.keyCode||"click"===a.type)){d=e.getAttribute("data-draggroups").split(" ");var f,g,h=!1;for(f=0;f<d.length;f++){for(g=0;g<this.groups.length;g++)if(d[f]===this.groups[g]){h=!0;break}if(h)break}h&&(b=e.ancestor(".yui3-dd-drop"),this.global_start_keyboard_drag(a,e,b),a.preventDefault())}}},drag_start:function(){},drag_end:function(){},drag_drag:function(){},drag_dropmiss:function(){},drop_over:function(){},drop_hit:function(){}},{NAME:"dragdrop",ATTRS:{}}),M.core=M.core||{},M.core.dragdrop=d},"@VERSION@",{requires:["base","node","io","dom","dd","event-key","event-focus","moodle-core-notification"]});