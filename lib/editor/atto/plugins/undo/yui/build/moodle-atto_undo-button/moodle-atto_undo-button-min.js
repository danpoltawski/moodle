YUI.add("moodle-atto_undo-button",function(a,b){a.namespace("M.atto_undo").Button=a.Base.create("button",a.M.editor_atto.EditorPlugin,[],{_maxUndos:40,_undoStack:null,_redoStack:null,initializer:function(){this._undoStack=[],this._redoStack=[],this.addButton({title:"undo",icon:"e/undo",callback:this._undoHandler,buttonName:"undo",keys:90}),this.addButton({title:"redo",icon:"e/redo",callback:this._redoHandler,buttonName:"redo",keys:89}),this.get("host").on("pluginsloaded",function(){this._addToUndo(this._getHTML()),this.get("host").on("atto:selectionchanged",this._changeListener,this)},this),this._updateButtonsStates()},_addToRedo:function(a){this._redoStack.push(a)},_addToUndo:function(a,b){var c=this._undoStack[this._undoStack.length-1];for("undefined"==typeof b&&(b=!1),c!==a&&(this._undoStack.push(a),b&&(this._redoStack=[]));this._undoStack.length>this._maxUndos;)this._undoStack.shift()},_getHTML:function(){return this.get("host").getCleanHTML()},_getRedo:function(){return this._redoStack.pop()},_getUndo:function(a){if(1===this._undoStack.length)return this._undoStack[0];var b=this._undoStack.pop();return b===a&&(b=this._undoStack.pop()),0===this._undoStack.length&&this._addToUndo(b),b},_restoreValue:function(a){this.editor.setHTML(a),this._addToUndo(a)},_updateButtonsStates:function(){this._undoStack.length>1?this.enableButtons("undo"):this.disableButtons("undo"),this._redoStack.length>0?this.enableButtons("redo"):this.disableButtons("redo")},_undoHandler:function(a){a.preventDefault();var b=this._getHTML(),c=this._getUndo(b);return b===c?void this._updateButtonsStates():(this._restoreValue(c),this._addToRedo(b),void this._updateButtonsStates())},_redoHandler:function(a){a.preventDefault();var b=this._getHTML(),c=this._getRedo();return b===c?void this._updateButtonsStates():(this._restoreValue(c),void this._updateButtonsStates())},_changeListener:function(a){a.event&&a.event.type.indexOf("key")!==-1&&39!==a.event.keyCode&&37!==a.event.keyCode&&40!==a.event.keyCode&&38!==a.event.keyCode||(this._addToUndo(this._getHTML(),!0),this._updateButtonsStates())}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});