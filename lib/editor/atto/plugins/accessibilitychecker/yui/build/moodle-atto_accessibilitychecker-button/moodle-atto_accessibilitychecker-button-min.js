YUI.add("moodle-atto_accessibilitychecker-button",function(a,b){var c="atto_accessibilitychecker";a.namespace("M.atto_accessibilitychecker").Button=a.Base.create("button",a.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({icon:"e/accessibility_checker",callback:this._displayDialogue})},_displayDialogue:function(){var a=this.getDialogue({headerContent:M.util.get_string("pluginname",c),width:"500px",focusAfterHide:!0});a.set("bodyContent",this._getDialogueContent()).show()},_getDialogueContent:function(){var b=a.Node.create('<div style="word-wrap: break-word;"></div>');return b.append(this._getWarnings()),b.delegate("click",function(a){a.preventDefault();var b=this.get("host"),c=a.currentTarget.getData("sourceNode"),d=this.getDialogue();c?(d.set("focusAfterHide",this.editor).hide(),b.setSelection(b.getSelectionFromNode(c))):d.hide()},"a",this),b},_getWarnings:function(){var b,d=a.Node.create("<div></div>");return b=[],this.editor.all("img").each(function(a){var c=a.getAttribute("alt");"undefined"!=typeof c&&""!==c||"presentation"!==a.getAttribute("role")&&b.push(a)},this),this._addWarnings(d,M.util.get_string("imagesmissingalt",c),b,!0),b=[],this.editor.all("*").each(function(c){var d,e,f,g,h;if(""!==a.Lang.trim(c.get("text"))&&(d=c.getComputedStyle("color"),e=c.getComputedStyle("backgroundColor"),g=this._getLuminanceFromCssColor(d),h=this._getLuminanceFromCssColor(e),f=g>h?(g+.05)/(h+.05):(h+.05)/(g+.05),f<=4.5)){var i=0,j=!1;for(i=0;i<b.length;i++){if(c.ancestors("*").indexOf(b[i])!==-1){j=!0;break}if(b[i].ancestors("*").indexOf(c)!==-1){b[i]=c,j=!0;break}}j||b.push(c)}},this),this._addWarnings(d,M.util.get_string("needsmorecontrast",c),b,!1),this.editor.get("text").length>1e3&&!this.editor.one("h3, h4, h5")&&this._addWarnings(d,M.util.get_string("needsmoreheadings",c),[this.editor],!1),b=[],this.editor.all("table").each(function(a){var c=a.one("caption");null!==c&&""!==c.get("text").trim()||b.push(a)},this),this._addWarnings(d,M.util.get_string("tablesmissingcaption",c),b,!1),b=[],this.editor.all("table").each(function(a){var c=a.one("[colspan],[rowspan]");null!==c&&b.push(a)},this),this._addWarnings(d,M.util.get_string("tableswithmergedcells",c),b,!1),b=[],this.editor.all("table").each(function(a){if(a.one("tr").one("td"))a.all("tr").some(function(c){var d=c.one("th");return(!d||""===d.get("text").trim())&&(b.push(a),!0)},this);else{var c=!1;a.one("tr").all("th").some(function(d){return c=!0,""===d.get("text").trim()&&(b.push(a),!0)}),c||b.push(a)}},this),this._addWarnings(d,M.util.get_string("tablesmissingheaders",c),b,!1),d.hasChildNodes()||d.append("<p>"+M.util.get_string("nowarnings",c)+"</p>"),d},_addWarnings:function(b,d,e,f){var g,h,i,j,k,l,m,n;if(e.length>0){for(g=a.Node.create("<p>"+d+"</p>"),h=a.Node.create('<ol class="accessibilitywarnings"></ol>'),i=0,i=0;i<e.length;i++)l=a.Node.create("<li></li>"),f?(j=e[i].getAttribute("src"),m=a.Node.create('<a href="#"><img src="'+j+'" /> '+j+"</a>")):(k="innerText"in e[i]?"innerText":"textContent",n=e[i].get(k).trim(),""===n&&(n=M.util.get_string("emptytext",c)),e[i]===this.editor&&(n=M.util.get_string("entiredocument",c)),m=a.Node.create('<a href="#">'+n+"</a>")),m.setData("sourceNode",e[i]),l.append(m),h.append(l);g.append(h),b.append(g)}},_getLuminanceFromCssColor:function(b){var c;"transparent"===b&&(b="#ffffff"),c=a.Color.toArray(a.Color.toRGB(b));var d=function(a){return a=parseInt(a,10)/255,a<=.03928?a/=12.92:a=Math.pow((a+.055)/1.055,2.4),a},e=d(c[0]),f=d(c[1]),g=d(c[2]);return.2126*e+.7152*f+.0722*g}})},"@VERSION@",{requires:["color-base","moodle-editor_atto-plugin"]});