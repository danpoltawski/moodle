YUI.add("moodle-course-categoryexpander",function(a,b){var c={CONTENTNODE:"content",COLLAPSEALL:"collapse-all",DISABLED:"disabled",LOADED:"loaded",NOTLOADED:"notloaded",SECTIONCOLLAPSED:"collapsed",HASCHILDREN:"with_children"},d={LOADEDTREES:".with_children.loaded",CONTENTNODE:".content",CATEGORYLISTENLINK:".category .info .categoryname",CATEGORYSPINNERLOCATION:".categoryname",CATEGORYWITHCOLLAPSEDLOADEDCHILDREN:".category.with_children.loaded.collapsed",CATEGORYWITHMAXIMISEDLOADEDCHILDREN:".category.with_children.loaded:not(.collapsed)",COLLAPSEEXPAND:".collapseexpand",COURSEBOX:".coursebox",COURSEBOXLISTENLINK:".coursebox .moreinfo",COURSEBOXSPINNERLOCATION:".coursename a",COURSECATEGORYTREE:".course_category_tree",PARENTWITHCHILDREN:".category"},e=a.namespace("Moodle.course.categoryexpander"),f=0,g=1,h=M.cfg.wwwroot+"/course/category.ajax.php";e.init=function(){var b=a.one(a.config.doc);b.delegate("click",this.toggle_category_expansion,d.CATEGORYLISTENLINK,this),b.delegate("click",this.toggle_coursebox_expansion,d.COURSEBOXLISTENLINK,this),b.delegate("click",this.collapse_expand_all,d.COLLAPSEEXPAND,this),b.once("key",this.setup_keyboard_listeners,"tab",this)},e.setup_keyboard_listeners=function(){var b=a.one(a.config.doc);b.all(d.CATEGORYLISTENLINK,d.COURSEBOXLISTENLINK,d.COLLAPSEEXPAND).setAttribute("tabindex","0"),a.one(a.config.doc).delegate("key",this.toggle_category_expansion,"enter",d.CATEGORYLISTENLINK,this),a.one(a.config.doc).delegate("key",this.toggle_coursebox_expansion,"enter",d.COURSEBOXLISTENLINK,this),a.one(a.config.doc).delegate("key",this.collapse_expand_all,"enter",d.COLLAPSEEXPAND,this)},e.toggle_category_expansion=function(b){a.use("io-base","json-parse","moodle-core-notification","anim-node-plugin",function(){e.toggle_category_expansion=e._toggle_category_expansion,e.toggle_category_expansion(b)})},e.toggle_coursebox_expansion=function(b){a.use("io-base","json-parse","moodle-core-notification","anim-node-plugin",function(){e.toggle_coursebox_expansion=e._toggle_coursebox_expansion,e.toggle_coursebox_expansion(b)}),b.preventDefault()},e._toggle_coursebox_expansion=function(a){var b;return b=a.target.ancestor(d.COURSEBOX,!0),a.preventDefault(),b.hasClass(c.LOADED)?void this.run_expansion(b):void this._toggle_generic_expansion({parentnode:b,childnode:b.one(d.CONTENTNODE),spinnerhandle:d.COURSEBOXSPINNERLOCATION,data:{courseid:b.getData("courseid"),type:g}})},e._toggle_category_expansion=function(a){var b,e,g;if(!a.target.test("a")&&!a.target.test("img")&&(b=a.target.ancestor(d.PARENTWITHCHILDREN,!0),b.hasClass(c.HASCHILDREN))){if(b.hasClass(c.LOADED))return void this.run_expansion(b);e=b.getData("categoryid"),g=b.getData("depth"),"undefined"!=typeof e&&"undefined"!=typeof g&&this._toggle_generic_expansion({parentnode:b,childnode:b.one(d.CONTENTNODE),spinnerhandle:d.CATEGORYSPINNERLOCATION,data:{categoryid:e,depth:g,showcourses:b.getData("showcourses"),type:f}})}},e._toggle_generic_expansion=function(b){var c;b.spinnerhandle&&(c=M.util.add_spinner(a,b.parentnode.one(b.spinnerhandle)).show()),a.io(h,{method:"POST",context:this,on:{complete:this.process_results},data:b.data,arguments:{parentnode:b.parentnode,childnode:b.childnode,spinner:c}})},e.run_expansion=function(a){var b=a.one(d.CONTENTNODE),e=this,f=a.ancestor(d.COURSECATEGORYTREE);this.add_animation(b),a.hasClass(c.SECTIONCOLLAPSED)?(b.setStyle("height","0"),a.removeClass(c.SECTIONCOLLAPSED),a.setAttribute("aria-expanded","true"),b.fx.set("reverse",!1)):(b.fx.set("reverse",!0),b.fx.once("end",function(a,b){b.addClass(c.SECTIONCOLLAPSED),b.setAttribute("aria-expanded","false")},this,a)),b.fx.once("end",function(a,b){b.setStyles({height:"",opacity:""}),this.destroy(),e.update_collapsible_actions(f)},b.fx,b),b.fx.run()},e.collapse_expand_all=function(b){a.use("io-base","json-parse","moodle-core-notification","anim-node-plugin",function(){e.collapse_expand_all=e._collapse_expand_all,e.collapse_expand_all(b)}),b.preventDefault()},e._collapse_expand_all=function(a){if(a.preventDefault(),!a.currentTarget.hasClass(c.DISABLED)){var b=a.currentTarget.ancestor(d.COURSECATEGORYTREE);if(b){var e=b.one(d.COLLAPSEEXPAND);e.hasClass(c.COLLAPSEALL)?this.collapse_all(b):this.expand_all(b),this.update_collapsible_actions(b)}}},e.expand_all=function(b){var e=[];b.all(d.CATEGORYWITHCOLLAPSEDLOADEDCHILDREN).each(function(a){a.ancestor(d.CATEGORYWITHCOLLAPSEDLOADEDCHILDREN)?(a.removeClass(c.SECTIONCOLLAPSED),a.all(d.LOADEDTREES).removeClass(c.SECTIONCOLLAPSED)):e.push(a)},this),a.all(e).each(function(a){this.run_expansion(a)},this)},e.collapse_all=function(b){var e=[];b.all(d.CATEGORYWITHMAXIMISEDLOADEDCHILDREN).each(function(a){a.ancestor(d.CATEGORYWITHMAXIMISEDLOADEDCHILDREN)?e.push(a):this.run_expansion(a)},this),a.all(e).each(function(a){a.addClass(c.SECTIONCOLLAPSED),a.all(d.LOADEDTREES).addClass(c.SECTIONCOLLAPSED)},this)},e.update_collapsible_actions=function(a){var b=!1,e=a.one(d.COLLAPSEEXPAND);e&&(a.all(d.CATEGORYWITHMAXIMISEDLOADEDCHILDREN).each(function(a){return!a.ancestor(d.CATEGORYWITHCOLLAPSEDLOADEDCHILDREN)&&(b=!0,!0)}),b?e.setHTML(M.util.get_string("collapseall","moodle")).addClass(c.COLLAPSEALL).removeClass(c.DISABLED):e.setHTML(M.util.get_string("expandall","moodle")).removeClass(c.COLLAPSEALL).removeClass(c.DISABLED))},e.process_results=function(b,d,e){var f,g;try{if(g=a.JSON.parse(d.responseText),g.error)return new M.core.ajaxException(g)}catch(h){return new M.core.exception(h)}f=a.Node.create(g),e.childnode.appendChild(f),e.parentnode.addClass(c.LOADED).removeClass(c.NOTLOADED),this.run_expansion(e.parentnode),e.spinner&&e.spinner.hide().destroy()},e.add_animation=function(b){return"undefined"!=typeof b.fx?b:(b.plug(a.Plugin.NodeFX,{from:{height:0,opacity:0},to:{height:function(a){return a.get("scrollHeight")},opacity:1},duration:.2}),b)}},"@VERSION@",{requires:["node","event-key"]});