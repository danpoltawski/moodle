YUI.add("moodle-course-toolboxes",function(a,b){var c={ACTIVITYINSTANCE:"activityinstance",AVAILABILITYINFODIV:"div.availabilityinfo",CONTENTWITHOUTLINK:"contentwithoutlink",CONDITIONALHIDDEN:"conditionalhidden",DIMCLASS:"dimmed",DIMMEDTEXT:"dimmed_text",EDITINSTRUCTIONS:"editinstructions",HIDE:"hide",MODINDENTCOUNT:"mod-indent-",MODINDENTHUGE:"mod-indent-huge",MODULEIDPREFIX:"module-",SECTIONHIDDENCLASS:"hidden",SECTIONIDPREFIX:"section-",SHOW:"editing_show"},d={ACTIONAREA:".actions",ACTIONLINKTEXT:".actionlinktext",ACTIVITYACTION:"a.cm-edit-action[data-action]",ACTIVITYICON:"img.activityicon",ACTIVITYINSTANCE:"."+c.ACTIVITYINSTANCE,ACTIVITYLINK:"."+c.ACTIVITYINSTANCE+" > a, ."+c.ACTIVITYINSTANCE+" > span[data-inplaceeditable] > a:not([data-inplaceeditablelink])",ACTIVITYLI:"li.activity",COMMANDSPAN:".commands",CONTENTAFTERLINK:"div.contentafterlink",CONTENTWITHOUTLINK:"div.contentwithoutlink",GROUPINGLABEL:"."+c.ACTIVITYINSTANCE+" .groupinglabel",HIDE:"a.editing_hide",HIGHLIGHT:"a.editing_highlight",INSTANCENAME:"span.instancename",MODINDENTDIV:".mod-indent",MODINDENTOUTER:".mod-indent-outer",PAGECONTENT:"body",SECTIONLI:"li.section",SHOW:"a."+c.SHOW,SHOWHIDE:"a.editing_showhide"},e={MIN:0,MAX:16},f=a.one(document.body);M.course=M.course||{};var g=function(){g.superclass.constructor.apply(this,arguments)};a.extend(g,a.Base,{send_request:function(b,c,d,e){b||(b={});var f,g=this.get("config").pageparams;for(f in g)b[f]=g[f];b.sesskey=M.cfg.sesskey,b.courseId=this.get("courseid");var h=M.cfg.wwwroot+this.get("ajaxurl"),i=[],j={method:"POST",data:b,on:{success:function(b,e){try{i=a.JSON.parse(e.responseText),i.error&&new M.core.ajaxException(i)}catch(f){}d&&a.bind(d,this,i)(),c&&window.setTimeout(function(){c.hide()},400)},failure:function(a,b){c&&c.hide(),new M.core.ajaxException(b)}},context:this};if(e)for(f in e)j[f]=e[f];return c&&c.show(),a.io(h,j),this}},{NAME:"course-toolbox",ATTRS:{courseid:{value:0},format:{value:"topics"},ajaxurl:{value:null},config:{value:{}}}});var h=function(){h.superclass.constructor.apply(this,arguments)};a.extend(h,g,{GROUPS_NONE:0,GROUPS_SEPARATE:1,GROUPS_VISIBLE:2,initializer:function(){M.course.coursebase.register_module(this),f.delegate("key",this.handle_data_action,"down:enter",d.ACTIVITYACTION,this),a.delegate("click",this.handle_data_action,f,d.ACTIVITYACTION,this)},handle_data_action:function(a){var b=a.target;b.test("a")||(b=b.ancestor(d.ACTIVITYACTION));var c=b.getData("action"),e=b.ancestor(d.ACTIVITYLI);if(b.test("a")&&c&&e)switch(c){case"moveleft":case"moveright":this.change_indent(a,b,e,c);break;case"delete":this.delete_with_confirmation(a,b,e,c);break;case"duplicate":this.duplicate(a,b,e,c);break;case"hide":case"show":this.change_visibility(a,b,e,c);break;case"groupsseparate":case"groupsvisible":case"groupsnone":this.change_groupmode(a,b,e,c);break;case"move":case"update":case"assignroles":}},add_spinner:function(b){var c=b.one(d.ACTIONAREA);return c?M.util.add_spinner(a,c):null},change_indent:function(b,f,g,h){b.preventDefault();var i,j="moveleft"===h?-1:1,k=g.one(d.MODINDENTDIV),l=k.getAttribute("class").match(/mod-indent-(\d{1,})/),m=0;if(l&&(m=parseInt(l[1],10)),i=m+parseInt(j,10),!(i<e.MIN||i>e.MAX)){l&&k.removeClass(l[0]),k.addClass(c.MODINDENTCOUNT+i);var n={"class":"resource",field:"indent",value:i,id:a.Moodle.core_course.util.cm.getId(g)},o=this.add_spinner(g);this.send_request(n,o);var p;i===e.MIN?(f.addClass("hidden"),p=g.one(".editing_moveright")):i>e.MIN&&m===e.MIN&&f.ancestor(".menu").one("[data-action=moveleft]").removeClass("hidden"),i===e.MAX?(f.addClass("hidden"),p=g.one(".editing_moveleft")):i<e.MAX&&m===e.MAX&&f.ancestor(".menu").one("[data-action=moveright]").removeClass("hidden");var q=k.hasClass(c.MODINDENTHUGE);i>15&&!q?k.addClass(c.MODINDENTHUGE):i<=15&&q&&k.removeClass(c.MODINDENTHUGE),b.type&&"key"===b.type&&p&&p.focus()}},delete_with_confirmation:function(b,c,d){b.preventDefault();var e=d,f="",g={type:M.util.get_string("pluginname",e.getAttribute("class").match(/modtype_([^\s]*)/)[1])};null!==a.Moodle.core_course.util.cm.getName(e)?(g.name=a.Moodle.core_course.util.cm.getName(e),f=M.util.get_string("deletechecktypename","moodle",g)):f=M.util.get_string("deletechecktype","moodle",g);var h=new M.core.confirm({question:f,modal:!0,visible:!1});return h.show(),h.on("complete-yes",function(){e.remove();var c={"class":"resource",action:"DELETE",id:a.Moodle.core_course.util.cm.getId(e)};this.send_request(c),M.core.actionmenu&&M.core.actionmenu.instance&&M.core.actionmenu.instance.hideMenu(b)},this),this},duplicate:function(b,c,d){b.preventDefault();var e=d,f=d.ancestor(M.course.format.get_section_selector(a)),g=M.util.add_lightbox(a,f).show(),h={"class":"resource",field:"duplicate",id:a.Moodle.core_course.util.cm.getId(e),sr:c.getData("sr")};return this.send_request(h,g,function(b){var c=a.Node.create(b.fullcontent);d.insert(c,"after"),a.use("moodle-course-coursebase",function(){M.course.coursebase.invoke_function("setup_for_resource",c)}),M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(c)}),this},change_visibility:function(b,c,d,e){b.preventDefault();var f=d,g=this.handle_resource_dim(c,d,e),h={"class":"resource",field:"visible",value:g,id:a.Moodle.core_course.util.cm.getId(f)},i=this.add_spinner(f);return this.send_request(h,i),this},handle_resource_dim:function(b,e,f){var g=c.DIMCLASS,h=e.one([d.ACTIVITYLINK,d.CONTENTWITHOUTLINK].join(", ")),i=e.one(c.AVAILABILITYINFODIV),j="hide"===f?"show":"hide",k=b.one("span"),l=M.util.get_string(j,"moodle"),m=b.one("img");return m.setAttrs({src:M.util.image_url("t/"+j)}),a.Lang.trim(b.getAttribute("title"))&&b.setAttribute("title",l),a.Lang.trim(m.getAttribute("alt"))&&m.setAttribute("alt",l),b.replaceClass("editing_"+f,"editing_"+j),b.setData("action",j),k&&k.set("text",l),e.one(d.CONTENTWITHOUTLINK)&&(h=e.one(d.CONTENTWITHOUTLINK),g=c.DIMMEDTEXT),h.hasClass(c.CONDITIONALHIDDEN)||("hide"===f?(h.addClass(g),e.all(d.CONTENTAFTERLINK).addClass(c.DIMMEDTEXT),e.all(d.GROUPINGLABEL).addClass(c.DIMMEDTEXT)):(h.removeClass(g),e.all(d.CONTENTAFTERLINK).removeClass(c.DIMMEDTEXT),e.all(d.GROUPINGLABEL).removeClass(c.DIMMEDTEXT))),i&&i.toggleClass(c.HIDE),"hide"===f?0:1},change_groupmode:function(b,c,d){b.preventDefault();var e,f,g,h=parseInt(c.getData("nextgroupmode"),10),i="",j="",k=h+1,l=c.one("img");k>2&&(k=0),h===this.GROUPS_NONE?(i="groupsnone",j=M.util.image_url("i/groupn","moodle")):h===this.GROUPS_SEPARATE?(i="groupsseparate",j=M.util.image_url("i/groups","moodle")):h===this.GROUPS_VISIBLE&&(i="groupsvisible",j=M.util.image_url("i/groupv","moodle")),e=M.util.get_string("clicktochangeinbrackets","moodle",M.util.get_string(i,"moodle"));var m=c.getData("action");return c.replaceClass("editing_"+m,"editing_"+i),l.setAttrs({src:j}),a.Lang.trim(c.getAttribute("title"))&&c.setAttribute("title",e).setData("action",i).setData("nextgroupmode",k),a.Lang.trim(l.getAttribute("alt"))&&l.setAttribute("alt",e),f={"class":"resource",field:"groupmode",value:h,id:a.Moodle.core_course.util.cm.getId(d)},g=this.add_spinner(d),this.send_request(f,g),this},set_visibility_resource_ui:function(a){var b=a.element,c=b.one(d.HIDE),e=!0,f=!1;if(c||(c=b.one(d.SHOW),e=!1,f=!0),"undefined"!=typeof a.visible&&(f=a.visible),e!==f){var g="hide";f&&(g="show"),this.handle_resource_dim(c,b,g)}}},{NAME:"course-resource-toolbox",ATTRS:{}}),M.course.resource_toolbox=null,M.course.init_resource_toolbox=function(a){return M.course.resource_toolbox=new h(a),M.course.resource_toolbox};var i=function(){i.superclass.constructor.apply(this,arguments)};a.extend(i,g,{initializer:function(){M.course.coursebase.register_module(this),a.delegate("click",this.toggle_highlight,d.PAGECONTENT,d.SECTIONLI+" "+d.HIGHLIGHT,this),a.delegate("click",this.toggle_hide_section,d.PAGECONTENT,d.SECTIONLI+" "+d.SHOWHIDE,this)},toggle_hide_section:function(b){b.preventDefault();var e,f,g,h=b.target.ancestor(M.course.format.get_section_selector(a)),i=b.target.ancestor("a",!0),j=i.one("img"),k=i.one("span");h.hasClass(c.SECTIONHIDDENCLASS)?(h.removeClass(c.SECTIONHIDDENCLASS),e=1,f="show",g="hide"):(h.addClass(c.SECTIONHIDDENCLASS),e=0,f="hide",g="show");var l=M.util.get_string(g+"fromothers","format_"+this.get("format"));j.setAttrs({alt:l,src:M.util.image_url("i/"+g)}),i.set("title",l),k&&k.set("text",l);var m={"class":"section",field:"visible",id:a.Moodle.core_course.util.section.getId(h.ancestor(M.course.format.get_section_wrapper(a),!0)),value:e},n=M.util.add_lightbox(a,h);n.show(),this.send_request(m,n,function(b){var c=h.all(d.ACTIVITYLI);c.each(function(c){var e;e=c.one(d.SHOW)?c.one(d.SHOW):c.one(d.HIDE);var g=a.Moodle.core_course.util.cm.getId(c);a.Array.indexOf(b.resourcestotoggle,""+g)!==-1&&M.course.resource_toolbox.handle_resource_dim(e,c,f)},this)})},toggle_highlight:function(b){b.preventDefault();var c=b.target.ancestor(M.course.format.get_section_selector(a)),e=b.target.ancestor("a",!0),f=e.one("img"),g=e.one("span"),h=c.hasClass("current"),i=0,j=M.util.get_string("markthistopic","moodle"),k=a.one(d.PAGECONTENT);if(k.all(M.course.format.get_section_selector(a)+".current "+d.HIGHLIGHT).set("title",j),k.all(M.course.format.get_section_selector(a)+".current "+d.HIGHLIGHT+" span").set("text",M.util.get_string("highlight","moodle")),k.all(M.course.format.get_section_selector(a)+".current "+d.HIGHLIGHT+" img").set("alt",j).set("src",M.util.image_url("i/marker")),k.all(M.course.format.get_section_selector(a)).removeClass("current"),!h){c.addClass("current"),i=a.Moodle.core_course.util.section.getId(c.ancestor(M.course.format.get_section_wrapper(a),!0));var l=M.util.get_string("markedthistopic","moodle");e.set("title",l),f.set("alt",l).set("src",M.util.image_url("i/marked")),g&&g.set("text",M.util.get_string("highlightoff","moodle"))}var m={"class":"course",field:"marker",value:i},n=M.util.add_lightbox(a,c);n.show(),this.send_request(m,n)}},{NAME:"course-section-toolbox",ATTRS:{}}),M.course.init_section_toolbox=function(a){return new i(a)}},"@VERSION@",{requires:["node","base","event-key","node","io","moodle-course-coursebase","moodle-course-util"]});