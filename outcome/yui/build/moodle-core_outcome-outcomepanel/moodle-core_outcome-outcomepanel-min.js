YUI.add("moodle-core_outcome-outcomepanel",function(e,t){var n,r=e.Lang,i,s,o="save",u,a="panel",f,l={OUTCOME_SET_GROUP:e.ClassNameManager.getClassName(t,"outcomesetgroup"),OUTCOME_SET:e.ClassNameManager.getClassName(t,"outcomeset"),OUTCOME_LIST:e.ClassNameManager.getClassName(t,"outcomelist")},c='{{#each outcomeSetList}}{{#if outcomeList}}<div class="{{../../cssOutcomeSetGroup}}"><div class="{{../../cssOutcomeSet}}" tabindex="0" role="button" data-outcomesetid="{{id}}" data-before-aria-label="{{{getString "openx" name}}}" data-after-aria-label="{{{getString "closex" name}}}">{{{name}}}</div><div class="{{../../cssOutcomeList}}"><span class="accesshide" aria-hidden="true">{{{getString "outcomesforx" name}}}</span>{{#each outcomeList}}<div class="outcome" tabindex="0" role="button" data-outcomeid="{{id}}">{{{description}}}</div>{{/each}}</div></div>{{/if}}{{/each}}',h=function(e,t){return M.util.get_string(e,"outcome",t)},p=function(){p.superclass.constructor.apply(this,arguments)};e.extend(p,e.Base,{initializer:function(){e.Handlebars.registerHelper("getString",h),f=e.Handlebars.compile(c),n=new M.core_outcome.SimpleIO({contextId:this.get("contextId")})},show_panel:function(t){this._ensure_panel_ready(function(){r.isArray(t)||(t=[]);var n=e.Array.map(t,function(e){return s.getById(e)});this.get("selectedOutcomes").reset(n),this.get(a).show()})},_ensure_panel_ready:function(e){if(i!==undefined&&s!==undefined){e.call(this);return}n.send({action:"get_mappable_outcomes"},function(t){!r.isArray(t.outcomeSetList)||t.outcomeSetList.length===0||!r.isArray(t.outcomeList)||t.outcomeList.length===0?new M.core.alert({title:M.str.moodle.error,message:M.str.outcome.nooutcomesfound,yesLabel:M.str.outcome.close,visible:!0}):(i=new M.core_outcome.OutcomeSetList,s=new M.core_outcome.OutcomeList,i.add(t.outcomeSetList),s.add(t.outcomeList),this._render_panel_ui(),this._bind_panel_ui(),e.call(this))},this)},_render_panel_ui:function(){var t=i.map(function(e){var t=e.toJSON();return t.outcomeList=[],s.each(function(n){n.get("outcomesetid")==e.get("id")&&t.outcomeList.push(n.toJSON())}),t});u=e.Node.create("<div></div>"),u.setHTML(f({outcomeSetList:t,cssOutcomeSetGroup:l.OUTCOME_SET_GROUP,cssOutcomeSet:l.OUTCOME_SET,cssOutcomeList:l.OUTCOME_LIST})),this.get(a).set("bodyContent",u)},_bind_panel_ui:function(){u.delegate("click",this._handle_select_outcome,".outcome",this),u.delegate("key",this._handle_select_outcome,"enter",".outcome",this);var e=this.get(a);u.all("."+l.OUTCOME_SET_GROUP).each(function(t){var n=t.one("."+l.OUTCOME_LIST),r=t.one("."+l.OUTCOME_SET);n.plug(M.core_outcome.ariacontrolled,{ariaLabelledBy:t.one("span.accesshide"),ariaState:"aria-expanded"}),r.plug(M.core_outcome.ariacontrol,{ariaControls:n,key:"enter"}),r.core_outcome_ariacontrol.on("afterToggle",function(){r.toggleClass("expanded"),setTimeout(function(){e.centered()},50)})}),this.get("selectedOutcomes").after(["add","remove","reset"],this._update_selected_outcome_sets,this),this.get("selectedOutcomes").after(["add","remove","reset"],this._update_selected_outcomes,this)},_handle_select_outcome:function(e){var t=s.getById(e.target.getData("outcomeid"));r.isNull(this.get("selectedOutcomes").getById(t.get("id")))?this.get("allowMultiple")?this.get("selectedOutcomes").add(t):this.get("selectedOutcomes").reset([t]):this.get("selectedOutcomes").remove(t)},_update_selected_outcomes:function(){s.each(function(e){var t=u.one('div[data-outcomeid="'+e.get("id")+'"]');r.isNull(this.get("selectedOutcomes").getById(e.get("id")))?t.removeClass("selected"):t.addClass("selected")},this)},_update_selected_outcome_sets:function(){var t=e.Array.dedupe(this.get("selectedOutcomes").get("outcomesetid")),n=e.Array.map(t,function(e){return i.getById(e)});this.get("selectedOutcomeSets").reset(n),i.each(function(e){var t=u.one('div[data-outcomesetid="'+e.get("id")+'"]');t&&(r.isNull(this.get("selectedOutcomeSets").getById(e.get("id")))?t.removeClass("selectedparent"):t.addClass("selectedparent"))},this)},_handle_panel_save:function(e){e.preventDefault(),this.fire(o),this.get(a).hide()},_handle_panel_cancel:function(e){e.preventDefault(),this.get(a).hide()},_create_panel:function(){var e=new M.core.dialogue({headerContent:M.str.outcome.selectoutcomes,width:"800px",centered:!0,render:!0,visible:!1,modal:!0});return e.plug(M.core_outcome.scrollpanel),e.addButton({value:M.str.outcome.ok,action:this._handle_panel_save,context:this}),e.addButton({value:M.str.moodle.cancel,action:this._handle_panel_cancel,context:this}),e}},{NAME:t,ATTRS:{contextId:{},allowMultiple:{value:!0,validator:r.isBoolean},selectedOutcomes:{value:new M.core_outcome.OutcomeList},selectedOutcomeSets:{value:new M.core_outcome.OutcomeSetList},panel:{readOnly:!0,valueFn:"_create_panel"}}}),M.core_outcome=M.core_outcome||{},M.core_outcome.outcomepanel=p,M.core_outcome.init_outcomepanel=function(e){return new p(e)}},"@VERSION@",{requires:["base","handlebars","moodle-core_outcome-models","moodle-core_outcome-scrollpanel","moodle-core_outcome-ariacontrol","moodle-core_outcome-ariacontrolled","moodle-core-notification-dialogue","moodle-core-notification-alert","moodle-core_outcome-simpleio"]});
