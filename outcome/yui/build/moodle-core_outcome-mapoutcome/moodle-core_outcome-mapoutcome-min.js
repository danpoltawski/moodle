YUI.add("moodle-core_outcome-mapoutcome",function(e,t){var n=e.Lang,r,i=M.util.image_url("t/delete","core"),s,o,u,a="contentBox",f="input[type=hidden]",l="a[data-action=add]",c="a[data-action=delete]",h='{{#unless isFrozen}}<a href="#" data-id="0" data-action="add" role="button">{{strselectoutcomes}}</a> {{/unless}}{{#unless outcomeSetList}}<div>{{strnoselectedoutcomes}}</div>{{else}}<ul class="{{classMappedOutcomes}}" tabindex="-1">{{#each outcomeSetList}}<li>{{{name}}}<ul>{{#each outcomeList}}<li tabindex="-1" class="outcome" data-outcomeid="{{id}}" data-outcomesetid="{{outcomesetid}}">{{#unless ../../../isFrozen}}<span class="actions"><a href="#" data-id="{{id}}" role="button" data-action="delete"><img src="{{../../../../urlImgDelete}}" /><span class="accesshide">{{{getString "deletex" description}}}</span></a></span>&nbsp;{{/unless}}{{{description}}}</li>{{/each}}</ul></li>{{/each}}</ul>{{/unless}}',p=function(e,t){return M.util.get_string(e,"outcome",t)},d=function(){d.superclass.constructor.apply(this,arguments)};e.extend(d,e.Widget,{initializer:function(){try{var t=this.get("saveNode").get("value");if(t.length>0){var n=e.JSON.parse(t);this.get("outcomeList").add(n.outcomes),this.get("outcomeSetList").add(n.outcomesets)}}catch(i){i.visible=!0,new M.core.exception(i)}r=M.core_outcome.init_outcomepanel({contextId:this.get("contextId")})},renderUI:function(){e.Handlebars.registerHelper("getString",p),s=e.Handlebars.compile(h),o=e.Node.create("<div></div>"),o.addClass(this.getClassName("content","wrapper")),this.get(a).append(o),this._render_template()},bindUI:function(){this.get("isFrozen")||(this.get(a).delegate("click",this._handle_select_outcomes,l,this),this.get(a).delegate("click",this._handle_remove_outcome,c,this),r.on("save",this._handle_save_selected_outcomes,this),r.get("panel").after("visibleChange",function(t){!t.newVal&&u instanceof e.Node&&(u.focus(),u=undefined)}),this.get("outcomeList").after(["remove","reset"],this._render_template,this),this.get("outcomeList").after(["add","remove","reset"],this._update_save_node,this))},_render_template:function(){var e=this.get("outcomeSetList").map(function(e){var t=e.toJSON();return t.outcomeList=[],this.get("outcomeList").each(function(n){n.get("outcomesetid")==e.get("id")&&t.outcomeList.push(n.toJSON())}),t},this);o.setHTML(s({isFrozen:this.get("isFrozen"),outcomeSetList:e,strselectoutcomes:M.str.outcome.selectoutcomes,strnoselectedoutcomes:M.str.outcome.noselectedoutcomes,classMappedOutcomes:this.getClassName("mapped","outcomes"),urlImgDelete:i}))},_update_save_node:function(){var t={outcomes:this.get("outcomeList").toJSON(),outcomesets:this.get("outcomeSetList").toJSON()};this.get("saveNode").set("value",e.JSON.stringify(t))},_handle_select_outcomes:function(e){e.preventDefault(),u=e.target;var t=this.get("outcomeList").map(function(e){return e.get("id")});r.show_panel(t)},_handle_save_selected_outcomes:function(){this.get("outcomeSetList").reset(r.get("selectedOutcomeSets").toArray()),this.get("outcomeList").reset(r.get("selectedOutcomes").toArray()),this.get("outcomeList").isEmpty()?u=o.one(l):u=this.get(a).one("."+this.getClassName("mapped","outcomes"))},_handle_remove_outcome:function(t){t.preventDefault();var n=t.target;n.test("a")||(n=n.ancestor("a"));var r=this.get("outcomeList").getById(n.getData("id")),i=this.get("outcomeList").filter(function(e){return e.get("outcomesetid")==r.get("outcomesetid")});if(i.length===1){var s=this.get("outcomeSetList").getById(r.get("outcomesetid"));this.get("outcomeSetList").remove(s)}this.get("outcomeList").remove(r);var o=this.get(a).one("."+this.getClassName("mapped","outcomes"));o instanceof e.Node||(o=this.get(a).one(l)),o.focus()}},{HTML_PARSER:{saveNode:f},NAME:t,ATTRS:{contextId:{},isFrozen:{value:!1,validator:n.isBoolean},saveNode:{validator:function(t){return t instanceof e.Node}},outcomeSetList:{value:new M.core_outcome.OutcomeSetList},outcomeList:{value:new M.core_outcome.OutcomeList}}}),M.core_outcome=M.core_outcome||{},M.core_outcome.mapoutcome=d,M.core_outcome.init_mapoutcome=function(e){var t=new d(e);return t.render(),t}},"@VERSION@",{requires:["widget","handlebars","json-parse","json-stringify","moodle-core_outcome-models","moodle-core_outcome-outcomepanel","moodle-core-notification-exception"]});
