YUI.add("moodle-report_loglive-fetchlogs",function(a,b){function c(){c.superclass.constructor.apply(this,arguments)}var d={NEWROW:"newrow",SPINNER:"spinner",ICONSMALL:"iconsmall"},e={NEWROW:"."+d.NEWROW,TBODY:".flexible tbody",PAUSEBUTTON:"#livelogs-pause-button",SPINNER:"."+d.SPINNER};a.extend(c,a.Base,{callBack:{},spinner:{},pauseButton:{},initializer:function(){0===this.get("page")&&(this.callBack=a.later(1e3*this.get("interval"),this,this.fetchRecentLogs,null,!0)),this.spinner=a.one(e.SPINNER),this.pauseButton=a.one(e.PAUSEBUTTON),this.spinner.hide(),a.one(e.PAUSEBUTTON).on("click",this.toggleUpdate,this)},fetchRecentLogs:function(){this.spinner.show();var b={logreader:this.get("logreader"),since:this.get("since"),page:this.get("page"),id:this.get("courseid")},c={method:"get",context:this,on:{complete:this.updateLogTable},data:b},d=M.cfg.wwwroot+"/report/loglive/loglive_ajax.php";a.io(d,c)},updateLogTable:function(b,c){a.later(600,this,"hideLoadingIcon");var d;try{if(d=a.JSON.parse(c.responseText),d.error)return a.use("moodle-core-notification-ajaxexception",function(){return new M.core.ajaxException(d)}),this}catch(f){return a.use("moodle-core-notification-exception",function(){return new M.core.exception(f)}),this}this.set("since",d.until);var g=d.logs,h=a.one(e.TBODY),i=null;if(h&&g){i=h.get("firstChild"),i&&h.insertBefore(g,i);var j=h.get("children").slice(this.get("perpage"));j.remove(),a.later(5e3,this,"removeHighlight",d.until)}},removeHighlight:function(b){a.all(".time"+b).removeClass(d.NEWROW)},hideLoadingIcon:function(){this.spinner.hide()},toggleUpdate:function(){this.callBack?(this.callBack.cancel(),this.callBack="",this.pauseButton.setContent(M.util.get_string("resume","report_loglive"))):(this.callBack=a.later(1e3*this.get("interval"),this,this.fetchRecentLogs,null,!0),this.pauseButton.setContent(M.util.get_string("pause","report_loglive")))}},{NAME:"fetchLogs",ATTRS:{since:null,courseid:0,page:0,perpage:100,interval:60,logreader:"logstore_standard"}}),a.namespace("M.report_loglive.FetchLogs").init=function(a){return new c(a)}},"@VERSION@",{requires:["base","event","node","io","node-event-delegate"]});